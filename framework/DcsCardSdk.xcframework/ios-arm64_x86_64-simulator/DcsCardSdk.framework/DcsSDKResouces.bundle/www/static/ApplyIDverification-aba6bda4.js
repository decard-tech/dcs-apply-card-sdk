var Z=Object.defineProperty;var M=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var P=(a,r,s)=>r in a?Z(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,W=(a,r)=>{for(var s in r||(r={}))D.call(r,s)&&P(a,s,r[s]);if(M)for(var s of M(r))F.call(r,s)&&P(a,s,r[s]);return a};var g=(a,r,s)=>new Promise((N,y)=>{var p=e=>{try{o(s.next(e))}catch(t){y(t)}},u=e=>{try{o(s.throw(e))}catch(t){y(t)}},o=e=>e.done?N(e.value):Promise.resolve(e.value).then(p,u);o((s=s.apply(a,r)).next())});import{r as Y,u as x,a as B,b as k,$ as ee,j as _,e as i,K as $,f as m,k as te,B as q,t as se,aY as oe,U as le,a4 as f,g as d,T as re,ag as ie}from"./index-6964e077.js";import{C as ne}from"./card-5ffd29b5.js";import{D as ae}from"./divider-efd6ebd0.js";function de(){const[a,r]=Y.useState(!1),{applicationType:s,channelApplyNo:N}=x(l=>l.cardApply);Y.useState("");const y=B(),p=k();ee();const{userInfo:u,identityCheckFlag:o,sdkData:e}=x(l=>l.user),{jumioBaseConfig:t}=x(l=>l.cardApply);console.log("jumio======"+JSON.stringify(t));const T=()=>g(this,null,function*(){if(a)return;r(!0);const l=yield se("/dcs-apply-online/jumio/getWorkflowToken",{userReference:u==null?void 0:u.userId,workflowKeyType:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.workflowKeyType:t==null?void 0:t.jumioSet.workflowKeyType,credentialsTypeValues:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.credentialsTypeValues:t==null?void 0:t.jumioSet.credentialsTypeValues,applyType:{2:2,4:1,3:1,5:3}[s],credentialsCountryValues:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.credentialsCountryValues:t==null?void 0:t.jumioSet.credentialsCountryValues,customerInternalReference:u==null?void 0:u.userId,applyNo:[2].includes(s)?N:""});y(oe(l.applyNo)),y(le(l));const n=l.token,c=[2].includes(s)?t==null?void 0:t.myInfoJumioSet.datacenter:t==null?void 0:t.jumioSet.datacenter;Jumio.initialize(n,c),Jumio.start(H,Q)}),G=l=>{console.log("obj",typeof l);let n;return typeof l.credentials=="string"?n=JSON.parse(l.credentials):n=l.credentials,W({idResult:n.filter(c=>c.credentialCategory.toUpperCase()=="ID")[0],faceResult:n.filter(c=>c.credentialCategory.toUpperCase()=="FACE")[0]},l)},H=l=>g(this,null,function*(){var I,v,R,j,V,z,O,C,K,L,E;console.log("这里是Jumio给我的回调啊",l),console.log("上面的不好复制，可以复制这里的数据哦",JSON.stringify(l));const n=yield G(l);if(console.log("成功回调",JSON.stringify(n)),!n.idResult.idNumber||!n.idResult.lastName||!n.idResult.firstName){f.show(d("jumio_miss_prams")),r(!1),T();return}let c=n.idResult;console.log("identityCheckFlag",o);let S="P",J=(I=c.idNumber)==null?void 0:I.toUpperCase(),w=(v=c.dateOfBirth)==null?void 0:v.toUpperCase(),h=(R=c.gender)==null?void 0:R.toUpperCase(),U=(j=c.firstName)==null?void 0:j.toUpperCase(),b=(V=c.lastName)==null?void 0:V.toUpperCase();if((o!=null&&o.includes("idType")||o!=null&&o.includes("idNo"))&&(S!=((z=e==null?void 0:e.idType)==null?void 0:z.toUpperCase())||J!=((O=e==null?void 0:e.idNo)==null?void 0:O.toUpperCase()))){f.show(d("user_identities_do_not_match")),console.log("----------------------->",S,e==null?void 0:e.idType),console.log("----------------------->",J,e==null?void 0:e.idNo),p(-1);return}if(o!=null&&o.includes("birthDate")&&w.replace(/-/g,"")!=((C=e==null?void 0:e.birthDate)==null?void 0:C.toUpperCase())){f.show(d("user_identities_do_not_match")),console.log("----------------------->",w,e==null?void 0:e.birthDate),p(-1);return}if(o!=null&&o.includes("gender")&&h!=null&&h!=((K=e==null?void 0:e.gender)==null?void 0:K.toUpperCase())){f.show(d("user_identities_do_not_match")),console.log("----------------------->",h,e==null?void 0:e.gender),p(-1);return}if((o!=null&&o.includes("firstName")||o!=null&&o.includes("lastName"))&&(!U.includes((L=e==null?void 0:e.firstName)==null?void 0:L.toUpperCase())||!b.includes((E=e==null?void 0:e.lastName)==null?void 0:E.toUpperCase()))){f.show(d("user_identities_do_not_match")),console.log("----------------------->",U,e==null?void 0:e.firstName),console.log("----------------------->",b,e==null?void 0:e.lastName),p(-1);return}y(re(n)),r(!1),A()}),Q=l=>{console.log("失败回调",JSON.stringify(l)),r(!1)},X=()=>{ie.confirm({title:d("jumioAlert_Title"),content:d("jumioAlert_cnt"),onConfirm:()=>{A()}})},A=()=>{s==2?p("/myinfo/4",{replace:!0}):s==4?p("/jumio/0",{replace:!0}):p(-1)};return _("div",{children:[s===2&&_("div",{className:"p-4 text-minor text-xs",children:[i($,{id:"jumio_myInfo_headDesc1"}),i($,{id:"jumio_myInfo_headDesc2"})]}),_(ne,{title:i(m,{id:"apply_jumio_passportTitle"}),style:{marginBottom:10},className:"p-0 rounded-lg text-xs px-5",headerClassName:"px-5",children:[s==2?i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"jumi_myInfo_cntDesc"})}):_(te,{children:[i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc1"})}),i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc2"})}),i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc3"})})]}),i(ae,{style:{height:1,backgroundColor:"#575799",marginTop:3,opacity:.2}}),i(q,{block:!0,type:"submit",color:"primary",size:"large",shape:"rounded",loading:a,onClick:T,children:i(m,{id:"apply_jumio_vertify"})}),s==2&&i(q,{block:!0,color:"primary",fill:"none",className:"text-center my-4 text-xs",onClick:X,children:i(m,{id:"jumio_btn_skip"})})]})]})}export{de as default};
