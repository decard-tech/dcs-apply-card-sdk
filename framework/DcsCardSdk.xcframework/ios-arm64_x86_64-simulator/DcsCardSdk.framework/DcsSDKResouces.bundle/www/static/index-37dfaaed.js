import{b as U,r as s,u as S,j as r,e as n,g as a,B as I,ah as W,t as x,a4 as X,aN as Z}from"./index-6964e077.js";import{C as T}from"./card-5ffd29b5.js";const ne=()=>{const R=U(),[D,d]=s.useState(!1),[L,w]=s.useState(""),[p,F]=s.useState(""),[m,E]=s.useState(""),[l,B]=s.useState(),[u,j]=s.useState(""),[g,v]=s.useState(!1),[b,C]=s.useState(!1),[A,N]=s.useState(!1),[P,_]=s.useState(!1),[Y,y]=s.useState(60),[h,k]=s.useState(!1),[i,z]=s.useState(),[$,K]=s.useState(""),O=S(e=>{var t;return(t=e.user.sdkData)==null?void 0:t.cardToken}),H=S(e=>{var t;return(t=e.user.sdkData)==null?void 0:t.custIdToken}),c=s.useRef([]);s.useEffect(()=>{if(h){const e=setInterval(()=>{y(t=>t===0?(clearInterval(e),k(!1),0):t-1)},1e3);return()=>clearInterval(e)}},[h]);const f=e=>t=>{if(t.target.value.length===t.target.maxLength){const o=e+1;o<c.current.length&&c.current[o]&&c.current[o].focus()}},q=e=>{console.log("验证码--------------",e.target.value);const t=e.target.value.replace(/\D/g,"").substring(0,6);w(t),e.target.value.length>=6&&(_(!0),x("/dcs-service-auth/sms/checkVerificationCode",{registerCode:t,sessionId:i==null?void 0:i.sessionId,returnCheckCredentials:!0,verificationType:"SDK_RESET_CARD_PIN"}).then(o=>{console.log("发送验证码成功",o),K(o),R("/set-new-password",{state:{checkCredentials:o,pinLength:l==null?void 0:l.pinLength,cardTokenCheckCredentials:l==null?void 0:l.cardTokenCheckCredentials}})}).finally(()=>{_(!1)}))},V=e=>{x("/dcs-service-auth/sms/sendVerificationCode",{verificationType:"SDK_RESET_CARD_PIN",fullPhoneNumber:e}).then(t=>{z(t),d(!0),k(!0),y(60),console.log("发送短信成功",t)})},G=()=>{if(u.length!==3){C(!0);return}N(!0),x("/dcs-service-user/customer/card/collect/getCardTokenCheckV2",{cardToken:O,custIdToken:H,cvv2:u,expiryDate:m+p}).then(e=>{e.verifyResult?(V(e.mobileNumber),B(e)):X.show({content:a("CVV_or_date_error")})}).finally(()=>{N(!1)})},J=e=>{F(e.target.value);const t=parseInt(e.target.value,10);isNaN(t)||t<1||t>12?v(!0):v(!1)},M=e=>{const t=e.target.value.replace(/\D/g,"");t.length<=2&&E(t)},Q=e=>{const t=e.target.value.replace(/\D/g,"");t.length<=3&&(j(t),t.length===3&&c.current[2]&&(C(!1),c.current[2].blur()))};return r("div",{className:"px-2",children:[n(T,{className:"my-2 text-[#f00]",children:r("div",{className:"flex items-center text-xs",children:[n("div",{className:"w-2 h-2 rounded-xl bg-[#f00] mr-2"}),n("div",{children:a("reset_pin_tip")})]})}),n(T,{children:r("div",{className:"m-2",children:[n("p",{className:"mb-2 text-lg font-bold",children:a("card_information")}),n("p",{className:"text-xs text-[#909DAA]",children:a("verificationTip1")}),r("div",{className:"flex justify-around mt-4 text-xs",children:[r("div",{className:"w-3/5 mr-4",children:[n("p",{children:a("card_expiryDate")}),r("div",{className:"flex justify-start items-center mt-1 text-sm",children:[n("input",{value:p,type:"number",className:"bg-[#F6F8FB] rounded border-none w-16 h-11 pl-2",maxLength:2,ref:e=>c.current[0]=e,onInput:f(0),onChange:J}),n("span",{className:"mx-2",children:"/"}),n("input",{value:m,type:"number",maxLength:2,className:"bg-[#F6F8FB] rounded border-none w-16 h-11 pl-2",ref:e=>c.current[1]=e,onInput:f(1),onChange:M})]})]}),r("div",{className:"w-2/5",children:[n("p",{children:"CVV"}),n("div",{className:"mt-1 text-sm",children:n("input",{type:"number",maxLength:3,value:u,onChange:Q,ref:e=>c.current[2]=e,onInput:f(2),className:"bg-[#F6F8FB] rounded border-none w-20 h-11 pl-2"})})]})]}),g&&n("p",{className:"text-xs text-[#f00] mt-2",children:a("common_mmRule")}),b&&n("p",{className:"text-xs text-[#f00] mt-2",children:a("common_mmRule_CVV")})]})}),n(I,{block:!0,loading:A,disabled:!p||!m||!u||b||g,shape:"rounded",color:"primary",className:"mt-12 w-80 m-auto text-sm h-11",onClick:()=>{G()},children:a("common_confirm")}),r(W,{visible:D,showCloseButton:!0,onMaskClick:()=>{d(!1)},onClose:()=>{d(!1)},bodyStyle:{padding:"40px 10px 0 20px",borderTopLeftRadius:"8px",borderTopRightRadius:"8px",minHeight:"70vh"},children:[n("p",{className:"mb-2 text-lg font-bold",children:a("apply_guide_otp_title")}),r("p",{className:"text-sm",children:[a("apply_guide_otp_tip1"),n("span",{className:"text-base font-semibold text-[#36f]",children:l==null?void 0:l.maskMobileNumber}),a("apply_guide_otp_tip2")]}),r("p",{className:"mt-4 mb-1",children:[i==null?void 0:i.otpPrefix," - "]}),r("div",{className:"text-center",children:[n("input",{type:"number",value:L,maxLength:6,onChange:q,className:"text-center h-11 text-base w-4/5 bg-[#F6F8FB] rounded-xl border-none",placeholder:a("otp_please_enter_code")}),P?n("div",{className:"flex justify-center items-center mt-5",children:n(Z,{style:{"--size":"18px"}})}):n("div",{children:h?r("p",{className:"text-center text-xs text-[#909DAA] mt-6",children:[a("otp__resent"),r("span",{children:[" ",Y]})]}):n(I,{block:!0,color:"primary",fill:"none",className:"text-center text-xs mt-4",onClick:()=>V(l==null?void 0:l.mobileNumber),children:a("otp__resent")})})]})]})]})};export{ne as default};
