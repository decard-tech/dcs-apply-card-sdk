import{a8 as H,a6 as O,aH as b,r as c,aD as I,aI as M,bg as y,a5 as u,aF as E,aR as Y,aG as k,bD as B}from"./index-6701bc4a.js";const C=p=>new Promise(n=>setTimeout(n,p)),f="adm-pull-to-refresh",F={pullingText:"下拉刷新",canReleaseText:"释放立即刷新",refreshingText:"加载中...",completeText:"刷新成功",completeDelay:500,disabled:!1,onRefresh:()=>{}},L=p=>{var n,h;const{locale:l}=H(),t=O(F,{refreshingText:`${l.common.loading}...`,pullingText:l.PullToRefresh.pulling,canReleaseText:l.PullToRefresh.canRelease,completeText:l.PullToRefresh.complete},p),d=(n=t.headHeight)!==null&&n!==void 0?n:b(40),D=(h=t.threshold)!==null&&h!==void 0?h:b(60),[r,a]=c.useState("pulling"),[S,o]=I(()=>({from:{height:0},config:{tension:300,friction:30,round:!0,clamp:!0}})),g=c.useRef(null),m=c.useRef(!1);c.useEffect(()=>{var e;(e=g.current)===null||e===void 0||e.addEventListener("touchmove",()=>{})},[]);const R=()=>new Promise(e=>{o.start({to:{height:0},onResolve(){a("pulling"),e()}})});function w(){return Y(this,void 0,void 0,function*(){o.start({height:d}),a("refreshing");try{yield t.onRefresh(),a("complete")}catch(e){throw R(),e}t.completeDelay>0&&(yield C(t.completeDelay)),R()})}M(e=>{if(r==="refreshing"||r==="complete")return;const{event:v}=e;if(e.last){m.current=!1,r==="canRelease"?w():o.start({height:0});return}const[,N]=e.movement,x=Math.ceil(N);if(e.first&&x>0){let $=function(i){return"scrollTop"in i?i.scrollTop:i.scrollY};const T=e.event.target;if(!T||!(T instanceof Element))return;let s=y(T);for(;;){if(!s||$(s)>0)return;if(s instanceof Window)break;s=y(s.parentNode)}m.current=!0}if(!m.current)return;v.cancelable&&v.preventDefault(),v.stopPropagation();const P=Math.max(k(x,0,0,d*5,.5),0);o.start({height:P}),a(P>D?"canRelease":"pulling")},{pointer:{touch:!0},axis:"y",target:g,enabled:!t.disabled,eventOptions:B?{passive:!1}:void 0});const _=()=>{var e;if(t.renderText)return(e=t.renderText)===null||e===void 0?void 0:e.call(t,r);if(r==="pulling")return t.pullingText;if(r==="canRelease")return t.canReleaseText;if(r==="refreshing")return t.refreshingText;if(r==="complete")return t.completeText};return u.createElement(E.div,{ref:g,className:f},u.createElement(E.div,{style:S,className:`${f}-head`},u.createElement("div",{className:`${f}-head-content`,style:{height:d}},_())),u.createElement("div",{className:`${f}-content`},t.children))};export{L as P,C as s};
