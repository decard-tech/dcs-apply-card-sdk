var R=Object.defineProperty;var A=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var v=(s,t,e)=>t in s?R(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,j=(s,t)=>{for(var e in t||(t={}))V.call(t,e)&&v(s,e,t[e]);if(A)for(var e of A(t))K.call(t,e)&&v(s,e,t[e]);return s};var x=(s,t,e)=>new Promise((r,p)=>{var i=n=>{try{m(e.next(n))}catch(c){p(c)}},u=n=>{try{m(e.throw(n))}catch(c){p(c)}},m=n=>n.done?r(n.value):Promise.resolve(n.value).then(i,u);m((e=e.apply(s,t)).next())});import{t as J,r as d,b as M,a as P,$ as W,u as k,T as q,j as h,e as l,S as z,f as N,K as _,B as I,Y as G,X as U}from"./index-6964e077.js";import{C as O}from"./card-5ffd29b5.js";const E=(s,t="SG")=>new Promise((e,r)=>{Jumio.initialize(s,t),Jumio.start(p=>x(void 0,null,function*(){console.log("jumio-成功",p);const i=yield Y(p);console.log("jumio-成功",JSON.stringify(E)),e(i)}),r)}),X=(s,t,e,r,p,i,u)=>new Promise((m,n)=>{J("/dcs-apply-online/jumio/getWorkflowToken",{userReference:i,workflowKeyType:s,credentialsTypeValues:t,applyType:e,thirdOrderId:r,credentialsCountryValues:p,customerInternalReference:i,applyNo:u||""}).then(c=>{m(c)}).catch(c=>{n(c)})}),Y=s=>{let t;return typeof s.credentials=="string"?t=JSON.parse(s.credentials):t=s.credentials,j({idResult:t.filter(e=>e.credentialCategory=="ID")[0],faceResult:t.filter(e=>e.credentialCategory=="FACE")[0]},s)},B=d.memo(()=>{const s=M(),t=P(),e=W(),[r,p]=d.useState("0"),[i,u]=d.useState([]),[m,n]=d.useState(!0),[c,$]=d.useState(!1),{userInfo:y}=k(a=>a.user),{jumioBaseConfig:o}=k(a=>a.cardApply),[L,g]=d.useState(!1),[f,D]=d.useState(),C=()=>{console.log("param===="+e.channelApplyNo),n(!0),J("/dcs-apply-online/card/apply/login/querySupplementedData",{channelApplyNo:e.channelApplyNo}).then(a=>{console.log("res===="+JSON.stringify(a.supplementDatas)),u(a.supplementDatas)}).finally(()=>{n(!1)})};d.useEffect(()=>(C(),()=>{t(q(void 0))}),[]);const T=a=>{t(G(5));const S={workflowKeyType:a,thirdOrderId:i[0].thirdOrderId};F(S)},F=a=>x(void 0,null,function*(){if(!(!(o!=null&&o.fileJumioSet)||!(y!=null&&y.userId))&&!L){g(!0);try{const S=yield X(a==null?void 0:a.workflowKeyType,o==null?void 0:o.fileJumioSet.credentialsTypeValues,"3",a==null?void 0:a.thirdOrderId,o==null?void 0:o.fileJumioSet.credentialsCountryValues,y==null?void 0:y.userId,e.channelApplyNo),b=yield E(S.token,o==null?void 0:o.fileJumioSet.datacenter);console.log("res====="+b),D(b),p("1"),g(!1)}catch(S){g(!1)}}});d.useEffect(()=>()=>{},[c]);const w=()=>{J("/dcs-apply-online/card/apply/login/submitSupplementData",{channelApplyNo:e==null?void 0:e.channelApplyNo,caseNo:i[0].thirdOrderId,supplementedDataList:[{jumioAccountId:f==null?void 0:f.accountId,supplementedType:i[0].supplementedType,jumioWorkflowExecutionId:f==null?void 0:f.workflowId,files:[]}]}).then(()=>{console.log("提交成功"),U(),s(-1)})};return h("div",{className:"p-2",children:[i.length===0&&m&&l(z,{}),i.find(a=>a.supplementedType===2)&&l(O,{title:h("div",{className:"pt-2",children:[h("p",{className:"font-bold text-sm mb-3",children:["1.",l(N,{id:"apply_jumio_passportTitle"})]}),l(_,{className:"text-minor text-xs ",id:"apply_jumio_passportDesc1_"})]}),children:l(I,{disabled:r==="1",onClick:()=>T("1"),block:!0,color:"primary",shape:"rounded",className:"my-2",children:l(N,{id:r=="0"?"apply_jumio_vertify":"apply_jumio_vertified"})})}),i.find(a=>a.supplementedType===1)&&l(O,{title:h("div",{className:"pt-2",children:[h("p",{className:"font-bold text-sm mb-3",children:["1.",l(N,{id:"apply_jumio_passportTitle"})]}),l(_,{className:"text-minor text-xs ",id:"apply_jumio_passportDesc1"}),l(_,{className:"text-minor text-xs ",id:"apply_jumio_passportDesc2"}),l(_,{className:"text-minor text-xs ",id:"apply_jumio_passportDesc3"})]}),children:l(I,{disabled:r==="1",onClick:()=>T("2"),block:!0,color:"primary",shape:"rounded",className:"my-2",children:l(N,{id:r=="0"?"apply_jumio_vertify":"apply_jumio_vertified"})})}),r==="1"&&l(I,{block:!0,shape:"rounded",color:"primary",className:"mt-4",onClick:()=>w(),children:l(N,{id:"common_submit"})})]})});export{B as default};
