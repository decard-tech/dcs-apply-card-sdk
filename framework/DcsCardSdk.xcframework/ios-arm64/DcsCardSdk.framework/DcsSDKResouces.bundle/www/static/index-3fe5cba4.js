var I=(u,p,n)=>new Promise((g,s)=>{var x=r=>{try{l(n.next(r))}catch(c){s(c)}},y=r=>{try{l(n.throw(r))}catch(c){s(c)}},l=r=>r.done?g(r.value):Promise.resolve(r.value).then(x,y);l((n=n.apply(u,p)).next())});import{O as $,u as d,r as f,b as q,M as z,a as H,a_ as S,P as T,Q as F,R as m,T as B,U as j,b3 as W,t as v,b4 as K,e as o,j as i,L,N as Q,h,k as Y,B as G,f as X,aK as Z,a4 as D,g as ee,a$ as ae}from"./index-6701bc4a.js";import{S as O}from"./index-532deba6.js";import{R as ne}from"./RecommendCard-692eb1cc.js";import"./index-87da04c9.js";import"./native-input-f54745c8.js";const pe=()=>{var A;const{search:u,state:p}=$();d(e=>e.app.locale);const n=d(e=>e.cardApply.cardDetails),g=d(e=>e.cardApply.versionAndCardId);d(e=>e.app.locale),f.useState(!1);const s=q();let[x]=z();const y=x.get("language"),l=H(),{applicationType:r}=d(e=>e.cardApply),{sdkData:c}=d(e=>e.user),[R,N]=f.useState(!1),[U,w]=f.useState(!1),[C,E]=f.useState(p==null?void 0:p.card),{productId:P,channelCreditCardId:V,language:oe,cardDetailVersion:le}=S();f.useEffect(()=>{J(),k();const e=()=>{document.visibilityState==="visible"&&(console.log("现在成功从myinfo回来了啊"),k())};return document.addEventListener("visibilitychange",e),()=>{console.log("ApplicationCard.useEffect卸载了"),document.removeEventListener("visibilitychange",e),l(T()),l(F("")),l(m("")),l(B()),l(j())}},[]);const k=()=>{typeof DcsCardBase!="undefined"&&DcsCardBase.getMyinfoCallBack("",e=>{l(T()),l(F("")),l(m("")),l(B()),l(j()),console.log("卡申请页面,SUCESS======================================================",e);let t=JSON.parse(decodeURIComponent(JSON.parse(e).data));console.log("innerJsonObj4",t),t.host=="callback"&&s(`/myinfo/1?${t.query}`)},e=>{console.log("ERROR======================================================"),console.log("myinfo回调失败",e)})},J=()=>{l(W(u)),N(!0),v("/dcs-apply-online/card/apply/login/queryCardsDetail/sdk",{productId:P,channelCreditCardId:V,language:y}).then(e=>{l(K(e[0])),console.log("返回什么",e)}).finally(()=>{N(!1)})};console.log("缓存的东西",n,g);const M=()=>I(void 0,null,function*(){var t;const e=S();if(window.ReactNativeWebView){const a=JSON.stringify(e);window.postMessage(a),(t=window.ReactNativeWebView)==null||t.postMessage(a)}else{if(!e.channelCreditCardId){D.show(ee("card_no_apply"));return}try{let a=C;if(a||(a=yield v("/dcs-apply-online/credit/product/info/getCardDataByProductId",{productId:e.productId})),l(ae({staff_id:e.staff_id,location:e.location})),console.log("applicationType",r),a.recommend===0||a.productList[0].fixedLimit==="1")if(r===2){const b=yield v("/dcs-apply-online/myinfo/getAuthoriseUrl/v3",{version:"v2"});location.href=b.requestUrl}else r===3?s("/manual/0",{replace:!0}):r===4&&s("/ApplyIDVerification");else E(a),w(!0)}finally{}}}),_=()=>{window.history.back()};return R?o(Y,{}):i("div",{style:{marginTop:`${L.get("deviceType")=="Android"?0:c.statusBarHeight}px`,width:"100vw",zIndex:1,borderColor:"#fff",overflowY:"hidden"},children:[o("div",{style:{"--border-bottom":"0",position:"fixed",backgroundColor:"#fff",top:0,width:"100vw",zIndex:"999",paddingTop:L.get("deviceType")=="Android"?0:`${c.statusBarHeight}px`},children:o(Q,{onBack:_,className:"font-bold",children:o("div",{className:"text-lg font-bold",children:n==null?void 0:n.pageTitle})})}),i("div",{style:{background:"#F6F8FB"},className:"min-h-screen mt-12",children:[o("div",{className:"flex justify-center items-center pt-5 ",children:(n==null?void 0:n.cardFace.length)>1?o(O,{trackOffset:15,slideSize:70,stuckAtBoundary:!1,style:{"--track-padding":" 0 0 16px"},children:(A=n==null?void 0:n.cardFace)==null?void 0:A.map((e,t)=>o(O.Item,{children:e.orientation=="1"?o("div",{className:"flex justify-center items-center",style:{height:220,width:140,margin:"0 auto"},children:o("div",{style:{transform:"rotate(90deg)"},children:o(h,{src:e.url,width:220,height:140})})}):o(h,{src:e.url,width:220,height:140})},t))}):o("div",{children:(n==null?void 0:n.cardFace[0].orientation)=="1"?o("div",{className:"flex justify-center items-center",style:{height:220,width:140,margin:"0 auto"},children:o("div",{style:{transform:"rotate(90deg)"},children:o(h,{src:n==null?void 0:n.cardFace[0].url,width:220,height:140})})}):o(h,{src:n==null?void 0:n.cardFace[0].url,width:220,height:140})})}),i("div",{className:"mx-3 bg-white px-2 rounded-lg pb-20",style:{marginTop:"-75px",paddingTop:"90px"},children:[o("h1",{className:"font-bold text-lg px-2 mb-3",children:n==null?void 0:n.cardName}),(n==null?void 0:n.cardDesc)&&o("p",{className:"text-xs p-2",children:n.cardDesc}),n==null?void 0:n.detail.map((e,t)=>i("div",{className:"mb-5 px-2",children:[(e==null?void 0:e.title)&&o("h2",{className:"text-base font-semibold text-[#25435F] pb-2",children:e==null?void 0:e.title}),(e==null?void 0:e.content)&&o("p",{className:"text-xs text-[#909DAA] pb-3",children:e==null?void 0:e.content}),(e==null?void 0:e.tip)&&o("p",{className:"text-xs text-[#909DAA] pb-3",children:e==null?void 0:e.tip}),e.link.length!=0&&e.link.map((a,b)=>o("a",{style:{display:"block"},className:"underline decoration-solid text-[#36f] text-xs",href:a==null?void 0:a.linkUrl,children:a==null?void 0:a.linkTitle},a.linkIndex))]},e.index)),n==null?void 0:n.frame.map((e,t)=>i("div",{className:"bg-[#F6F8FB] p-3 mb-3",children:[o("h2",{className:"text-base font-semibold",children:e==null?void 0:e.frameTitle}),(e==null?void 0:e.frameTitle2)&&o("h2",{className:"text-sm font-medium my-2",children:e==null?void 0:e.frameTitle2}),e.frameContent.map((a,b)=>i("div",{children:[o("div",{className:"mb-2",children:a.fcTitleFormat==1?o("p",{className:"text-xs  mb-2",children:a==null?void 0:a.fcTitle}):o("a",{style:{display:"block"},className:"underline decoration-solid text-[#36f] text-xs mb-2",href:a==null?void 0:a.fcTitleUrl,children:a==null?void 0:a.fcTitle})}),o("div",{children:a.fcContentFormat==1?o("p",{className:"text-xs text-[#909DAA] mb-2",children:a==null?void 0:a.fcContent}):o("a",{style:{display:"block"},className:"underline decoration-solid text-[#36f] text-xs mb-2",href:a==null?void 0:a.fcContentUrl,children:a==null?void 0:a.fcTitle})})]},a.fcIndex))]},e.frameIndex))]}),o("div",{className:"w-full safeBottm",style:{position:"fixed",bottom:0,boxShadow:"0px 6px 20px 0px rgba(37, 67, 95, 0.15)"},children:o(G,{className:"px-4 py-2 w-full",block:!0,color:"primary",shape:"rounded",onClick:M,children:o(X,{id:"common_apply_now"})})}),o(ne,{selCard:C,showVisitor:U,onClose:()=>(w(!1),Promise.resolve())}),o(Z,{position:"bottom"})]})]})};export{pe as default};
