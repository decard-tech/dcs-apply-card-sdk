var xe=Object.defineProperty,ze=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var L=Math.pow,Z=(t,c,a)=>c in t?xe(t,c,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[c]=a,u=(t,c)=>{for(var a in c||(c={}))Te.call(c,a)&&Z(t,a,c[a]);if(K)for(var a of K(c))Ne.call(c,a)&&Z(t,a,c[a]);return t},S=(t,c)=>ze(t,Le(c));var l=(t,c,a)=>new Promise((f,y)=>{var T=g=>{try{p(a.next(g))}catch(w){y(w)}},x=g=>{try{p(a.throw(g))}catch(w){y(w)}},p=g=>g.done?f(g.value):Promise.resolve(g.value).then(T,x);p((a=a.apply(t,c)).next())});import{r as d,u as j,a as Pe,b as Ae,F as I,s as q,c as Me,d as Be,L as n,i as Fe,j as v,e as r,g as U,N as He,f as b,B as _e,I as Ge,D as We,h as X,k as Q,l as Oe,m as Re,n as $e,o as Je,z as Ee,p as Ve,q as Ke,t as C,v as Ze,w as je,x as qe,y as Ue,A as Xe,C as Qe,E as Ye,S as De,G as eo}from"./index-6701bc4a.js";import{M as oo,O as so}from"./OTPInputPanel-c703fb99.js";import{C as to}from"./card-0f9563e7.js";import{R as ao}from"./index-c76bae8d.js";import"./search-bar-8ae064c9.js";import"./native-input-f54745c8.js";const ro="/static/logo-e26c729c.png";const Co=d.memo(()=>{var R,$;const t=j(e=>e.user),c=j(e=>e.app.locale),a=Pe(),f=Ae(),[y]=I.useForm(),[T,x]=d.useState(!1),[p,g]=d.useState(""),[w,Y]=d.useState(!1),[A,D]=d.useState(""),[ee,oe]=d.useState(""),[N,se]=d.useState(!1),[te,M]=d.useState(!1),[z,no]=d.useState("en-SG"),[ae,re]=d.useState(""),[co,ne]=d.useState(""),[lo,de]=d.useState(""),[B,ce]=d.useState(44),[le,ie]=d.useState(0),[i,F]=d.useState({phone:"",areaCode:"+65"}),[H,_]=d.useState(!1);function ge(){return console.log("generateRandomId",n.get("deviceId")),n.get("deviceId")||""}const ue=e=>{if(!e||e.length!==10){const J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let E="";for(let V=0;V<10;V++)E+=J.charAt(Math.floor(Math.random()*J.length));e=E}const o=Date.now().toString(),s=7,k=Math.floor(L(10,s-1)+Math.random()*(L(10,s)-L(10,s-1))).toString(),m=`${e}-${o.slice(0,13)}-${k}`;return n.remove("workflowId"),n.set("workflowId",m),a(eo(m)),m};function fe(){let e,o,s;e=device.platform,o=device.model,s=device.manufacturer,n.set("deviceModel",o),n.set("deviceType",e),n.set("manufacturer",s)}const G=()=>{let o="sit",s={localeLanguage:"en",statusBarHeight:44,localeCountry:"SG"};switch(2){case 1:s={environment:o,bizCode:"470101",orgCode:"2310300701",orgSecretKey:"3d778437352345cf8697a4070a82f425",phoneNumber:"10000000",areaCode:"+65",partnerID:"11111111110",externalUserId:"10086",localeCountry:"SG",localeLanguage:"en",statusBarHeight:44,externalWorkflowId:"11111111111"};break;case 2:s={environment:o,bizCode:"470102",bizType:"D001",accessToken:"xcCTlOwSWmixjoeeTvsvSLDQtXGhgfapzIZMTcKRJkJjIMKShZohLXQuRhopHSmB",partnerID:"ED1327944",firstName:"Gosthand",lastName:"Gosthand",gender:"F",birthDate:"19941214",nationality:"SGP",idType:"P",idNo:"ED1327944",address:"8 Lor 38 Geylang, Singapore",postCode:"398106",email:"gosthand.sg@gmail.com",localeLanguage:"en",statusBarHeight:44,localeCountry:"SG",externalWorkflowId:"1111111111",productInfo:[{productCode:"EV3699",cardType:"20",cardFlag:"M",cardFace:"https://cardsminio.dcscc.com/dcs-public/cardFace/DCS-Lite-Card.png"}]};break;case 3:s={environment:o,bizCode:"470102",bizType:"D002",accessToken:"ZnjfKntZRvTIPLkVlGwpBDSZdODtPdDNAdyWwsbcluXHnpIFSJzJazzHMIfFHlAe",localeLanguage:"en",statusBarHeight:44,localeCountry:"SG",externalWorkflowId:"11111111111"};break}return s},pe=e=>l(void 0,null,function*(){var o;if(console.log("_handleSdkInitData",e),((o=e==null?void 0:e.externalWorkflowId)==null?void 0:o.length)>64&&nativeApi.MessageSend("0x06","The externalWorkflowId is too long!"),n.remove("environment"),n.set("environment",e.environment),yield ue((e==null?void 0:e.orgCode)||""),n.remove("externalWorkflowId"),n.set("externalWorkflowId",e.externalWorkflowId),ye(e),e.areaCode&&!e.areaCode.includes("+")&&(e.areaCode="+"+e.areaCode),Ce(e.localeLanguage.includes("zh")?"zh-CN":"en-SG"),a(Oe(e)),F({phone:e.phoneNumber||"",areaCode:e.areaCode||"+65"}),e.phoneNumber&&e.areaCode&&y.setFieldsValue({mobile:{phone:e.phoneNumber,areaCode:e.areaCode}}),e.bizCode=="470101"){e.orgCode&&e.orgSecretKey&&e.areaCode&&e.phoneNumber?P(e):nativeApi.MessageSend("0x04");return}else if(e.bizCode=="470102"){e.bizType&&e.accessToken?e.bizType=="D001"?h("2",e):e.bizType=="D002"?h("3",e):e.bizType=="D003"?h("4",e):e.bizType=="D004"?h("5",e):e.bizType=="D005"?h("6",e):e.bizType=="D006"?h("7",e):e.bizType=="D007"?h("8",e):(console.log("11111",e.bizType,e.bizCode),nativeApi.MessageSend("0x03",e.bizType)):nativeApi.MessageSend("0x04");return}else console.log("2222",e.bizType,e.bizCode),nativeApi.MessageSend("0x03")}),he=()=>new Promise((e,o)=>l(void 0,null,function*(){try{let s;s=yield me(),ce(s.statusBarHeight||0),console.log("statusBarHeight",s.statusBarHeight),e(s)}catch(s){o(s)}})),me=()=>new Promise((e,o)=>{if(typeof DcsCardBase=="undefined")return G();DcsCardBase.getAuthInfo("",s=>{const k=JSON.parse(s);if(k.code==0){let m;k.data?m=JSON.parse(k.data):m=G(),e(m)}else console.log("未获取到sdk授权信息",s),nativeApi.MessageSend("0x06"),o(s)},s=>{console.log("获取基本信息失败",s),nativeApi.MessageSend("0x06"),o(s)})}),Ce=e=>{const o=e||(c==="zh-CN"?"en-SG":"zh-CN");Re.defaults.headers.language=o,$e({locale:o!=="zh-CN"?Je:Ee}),Ve.locale(o!=="zh-CN"?"en":"zh"),a(Ke(o!=="zh-CN"?"en-SG":"zh-CN"))};d.useEffect(()=>(document.addEventListener("deviceready",W,!1),()=>{document.removeEventListener("deviceready",W,!1)}),[]);const W=()=>l(void 0,null,function*(){a(q()),a(Me()),a(Be()),n.remove("token"),n.remove("externalWorkflowId"),n.remove("workflowId"),yield Se(),yield fe();const e=yield he();console.log("获取到的数据init",JSON.stringify(e)),pe(e)}),Se=()=>l(void 0,null,function*(){if(n.get("deviceId"))return Promise.resolve();const e=yield Fe.load(),o=yield e.get();return console.log("fpRes",e),console.log("result",o),n.set("deviceId",o.visitorId),Promise.resolve(o.visitorId)}),ye=e=>l(void 0,null,function*(){const o=yield C("/dcs-service-auth/cardSdk/queryOrganization",e);console.log("19941214","-",e.bizCode,"-",e.bizType,"-",o.bizCodeList,"-",o.bizTypeList),e.bizCode&&e.bizType&&(o.bizCodeList.indexOf(e==null?void 0:e.bizCode)==-1||o.bizTypeList.indexOf(e.bizType)==-1)&&nativeApi.MessageSend("0x02",{},"Failed to obtain relevant permissions!"),ne(o.bizCodeList),de(o.bizTypeList),n.set("exitCode",o.exitCodeList||[]),a(Ze(o.identityCheckFlag||"")),a(je(o.cardListFlag)),a(qe(o.recommendCardListFlag)),a(Ue(o.applyPhoneNumberflag||0)),a(Xe(o)),a(Qe(o.showNameMaskOnCard))}),h=(e,o)=>l(void 0,null,function*(){console.log("是否走了这个0");try{_(!0),console.log("是否走了这个1");const s=yield C("/dcs-service-auth/cardSdk/init",S(u({},o||t.sdkData),{deviceId:ge(),workflowId:t.workflowId}));if(console.log("是否走了这个2"),!s)return;n.set("token",s.token),n.set("orgCode",s.orgCode),a(q(u({},s))),ke(),console.log("是否走了这个3"),e=="2"?f(`/application-method?language=${z}`):e=="3"?f(`/application-status?language=${z}`):e=="4"?f(`/userinfo?language=${z}`):e=="5"||e=="6"||e=="7"||e=="8"&&f(`/card-reset-pin?language=${z}`)}catch(s){}_(!1)}),we=e=>l(void 0,null,function*(){try{const o=yield C("/dcs-service-auth/cardSdk/getToken",e);return o?(nativeApi.MessageSend("0x00",S(u({},o),{workflowId:t.workflowId})),o):void 0}catch(o){return Promise.reject(o)}}),ke=()=>l(void 0,null,function*(){yield C("/dcs-service-user/settings/queryAppFrontSetting",{a:"1"}).then(e=>{e&&a(Ye(e))})}),P=e=>l(void 0,null,function*(){try{const o=yield C("/dcs-service-auth/cardSdk/captcha/img",S(u({},e||(t==null?void 0:t.sdkData)),{workflowId:t.workflowId}));if(!o)return;g("data:image/png;base64,"+o)}catch(o){}}),Ie=e=>l(void 0,null,function*(){return yield C("/dcs-service-auth/cardSdk/verificationCode/phone/check",S(u({sessionId:ee,registerCode:e},t.sdkData),{workflowId:t.workflowId}))}),O=()=>l(void 0,null,function*(){const e=yield C("/dcs-service-auth/cardSdk/verificationCode/phone",u({captcha:A,workflowId:t.workflowId},t.sdkData));if(e)return ie(e.realNameAuthentication),oe(e.sessionId),re(e.otpPrefix),Y(!0),g(""),e}),ve=()=>l(void 0,null,function*(){x(!0),O().then(e=>{M(!0)}).finally(()=>{P(),x(!1)})}),be=e=>l(void 0,null,function*(){let o=yield Ie(e);if(!o)return;if(le){f(`/UserAuthentication?checkCredentials=${o}`);return}let s=S(u({checkCredentials:o},t.sdkData),{workflowId:t.workflowId});return we(s)});return console.log("userStore",t),v("div",{className:"bg-white fixed shadow-sm",style:{top:`${n.get("deviceType")=="Android"?0:B}px`,width:"100vw",zIndex:1},children:[r(He,{className:"font-bold",style:{"--border-bottom":"0",position:"fixed",backgroundColor:"#fff",top:n.get("deviceType")=="Android"?0:`${B}px`,width:"100vw",zIndex:"999"},onBack:()=>{nativeApi.MessageSend("0x01")},children:U("dcs_user_authorization")}),v("div",{style:{paddingTop:"50px"},children:[r("div",{style:{justifyContent:"center",alignItems:"center",display:"flex",backgroundColor:"#001489",height:"100px"},children:r(X,{src:ro,width:"100px"})}),H&&r(De,{}),!H&&r(to,{title:r(b,{id:"apply_guide_otp_title"}),style:{marginBottom:10},className:"p-0 rounded-lg text-xs px-5",headerClassName:"px-5",children:v(I,{form:y,footer:r(_e,{shape:"rounded",block:!0,type:"submit",color:"primary",size:"large",onClick:ve,disabled:!(A.trim()&&N),loading:T,children:w?r(b,{id:"common_submit"}):r(b,{id:"common_next"})}),children:[r(I.Item,{name:"mobile",label:r(b,{id:"apply_form_mobile_phone"}),initialValue:{areaCode:((R=i==null?void 0:i.areaCode)==null?void 0:R.split(" ")[0])||"+65",phone:i==null?void 0:i.phone},children:r(oo,{disabled:!0,onChange:e=>{F({phone:e.phone,areaCode:e.areaCode.toString()})}})}),r(I.Item,{name:"imgcode",label:r(b,{id:"img_code"}),children:v("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:[r(Ge,{type:"number",placeholder:U("solve_the_equation"),onChange:e=>{D(e)}}),!p&&r(We,{}),p&&r(X,{src:p,width:250,height:40,onClick:()=>P()})]})}),r(I.Item,{children:r(ao,{value:"1",checked:N,onClick:e=>{e.preventDefault(),se(!N)},children:v("div",{style:{fontSize:"12px",lineHeight:"18px",color:"#25435F"},children:["I acknowledge that this card is issued by DCS Card Centre and I have read and agree with the",t.cardsTermsConditions?r("a",{href:t.cardsTermsConditions,target:"_blank",className:"text-blue",onClick:e=>{e.stopPropagation()},children:" Terms & Conditions "}):r(Q,{children:" Terms & Conditions "}),"and",t.privacyPolicy?r("a",{href:t.privacyPolicy,target:"_blank",className:"text-blue",onClick:e=>{e.stopPropagation()},children:" Privacy Policy "}):r(Q,{children:" Privacy Policy "}),"which can also be found in the Legal section of the app."]})})})]})}),r(so,{onSend:O,show:te,onConfirm:be,onClose:()=>{M(!1)},prefix:ae,phone:`${(($=i==null?void 0:i.areaCode)==null?void 0:$.split(" ")[0])||"+65"} ${i==null?void 0:i.phone}`,removeRe:!0})]})]})});export{Co as default};
