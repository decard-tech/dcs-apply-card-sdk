var Ye=Object.defineProperty,Be=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var Ie=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var Re=(l,a,_)=>a in l?Ye(l,a,{enumerable:!0,configurable:!0,writable:!0,value:_}):l[a]=_,ae=(l,a)=>{for(var _ in a||(a={}))Me.call(a,_)&&Re(l,_,a[_]);if(Ie)for(var _ of Ie(a))qe.call(a,_)&&Re(l,_,a[_]);return l},_e=(l,a)=>Be(l,Ue(a));var X=(l,a,_)=>new Promise((n,d)=>{var i=p=>{try{C(_.next(p))}catch(f){d(f)}},F=p=>{try{C(_.throw(p))}catch(f){d(f)}},C=p=>p.done?n(p.value):Promise.resolve(p.value).then(i,F);C((_=_.apply(l,a)).next())});import{r as y,u as Y,a as me,e,f as s,j as r,F as g,g as t,I as O,a0 as U,k as M,b as Ae,B as q,K as N,a1 as ie,a3 as Te,p as xe,ad as ze,J as je,h as ce,ae as W,af as He,ag as $e,ah as Ge,ai as Oe,t as K,aj as Ke,ak as Qe,al as Ze,am as be,a4 as ye,m as Ee,an as pe,ao as de,ap as Ne,O as Le,aq as We,D as De,M as Je,$ as Xe,R as et,ar as tt}from"./index-6701bc4a.js";import{S as lt}from"./index-9f281666.js";import{S as ne}from"./index-ba23ef6c.js";import{M as at,D as rt,O as st}from"./OTPInputPanel-c703fb99.js";import{D as ge,S as it,F as nt}from"./myinfoform-ac8901f5.js";import{C as z}from"./card-0f9563e7.js";import{C as he}from"./index-87da04c9.js";import{D as ot}from"./index-5411defb.js";import{R as re}from"./index-c76bae8d.js";import{T as fe,I as ct,U as oe}from"./Upload-1764b96d.js";import"./search-bar-8ae064c9.js";import"./native-input-f54745c8.js";import"./ResizeObserver.es-b51b3958.js";const dt=y.memo(()=>{var i,F;const{userMobile:l}=Y(C=>C.app),{userInfo:a,applyPhoneNumberflag:_}=Y(C=>C.user);let{applayCardDraftDataJumio:n,appliedCards:d}=Y(C=>C.cardApply);return n=ae({},n),me(),y.useMemo(()=>{var C;return d[0]&&((C=d[0].productList[0])==null?void 0:C.tenCardsFlag)},[d]),_&&(n.mobile=(a==null?void 0:a.areaCode)+" "+(a==null?void 0:a.phoneNumber)),n?e(z,{title:e(s,{id:"apply_form_personal_info"}),className:"p-0 rounded-lg text-xs",headerClassName:"px-5",children:r(U,{block:!0,direction:"vertical",className:"px-5 pb-5 rounded-lg",children:[e(g.Item,{name:"homeCountryIdNumber",label:e(s,{id:"apply_upgrade_home_country_num"}),rules:[{required:!0},{pattern:/^[a-zA-Z0-9-_ ]*$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:n==null?void 0:n.homeCountryIdNumber,children:e(O,{maxLength:20,placeholder:t("apply_form_please_enter")+t("apply_upgrade_home_country_num")})}),e(g.Item,{name:"email",label:e(s,{id:"apply_form_email"}),rules:[{required:!0,type:"email"}],initialValue:n==null?void 0:n.email,children:e(O,{maxLength:320,placeholder:t("apply_form_please_enter")+t("apply_form_email")})}),e(g.Item,{name:"mobile",label:e(s,{id:"apply_form_mobile_phone"}),rules:[{required:!0,validator:(C,p)=>{if(p!=null&&p.phone){if(p.areaCode==="+65"&&!/^[0-9]{8}$/.test(p.phone))return Promise.reject(t("rule_digits",{string:"8"}));if(p.areaCode==="+86"&&!/^[0-9]{11}$/.test(p.phone))return Promise.reject(t("rule_digits",{string:"11"}));if(!/^[0-9]{8,20}$/.test(p.phone))return Promise.reject(t("rule_digits",{string:"8-20"}))}return Promise.resolve()}}],initialValue:{areaCode:((i=(n==null?void 0:n.mobile)||l)==null?void 0:i.split(" ")[0])||"+65",phone:((F=(n==null?void 0:n.mobile)||l)==null?void 0:F.split(" ")[1])||""},children:e(at,{disabled:!!_})})]})}):e(M,{})}),pt=y.memo(()=>{var C,p,f;const{applayCardDraftDataJumio:l,jumioInfoData:a,appliedCards:_,billingAddressCountry:n}=Y(m=>m.cardApply);Y(m=>m.user);const d=Ae();y.useState(!1),y.useMemo(()=>({0:t("status_submitted"),1:t("status_processing"),2:t("status_approved"),3:t("status_supporting_documents"),4:t("status_rejected"),5:t("status_cancel")}),[]),console.log("appliedCards",_),console.log("jumioInfoData0",a),console.log("applayCardDraftDataJumio",l),(p=(C=_[0])==null?void 0:C.productList[0])!=null&&p.tenCardsFlag;const i=m=>{if(console.log("res地址是什么",m),!m)return"-";if(m.country==="SG")return`${m.block} ${m.street} # ${m.floor}-${m.unit} ${m.building||"-"} ${m.country} (${m.postal})`;if(m!=null&&m.line1)return`${m.line1} ${m==null?void 0:m.country}`},F=m=>typeof m!="string"||!m?"-":m.length===2?ie("COUNTRY_CODE_ISO2",m):ie("COUNTRY_CODE_ISO3",m);return l?r(U,{direction:"vertical",block:!0,children:[e(z,{title:r("div",{className:"flex justify-between items-center text-sm",children:[e(s,{id:"apply_form_declaration_particulars"}),e(q,{color:"primary",fill:"none",className:"text-xs font-normal",onClick:()=>{d("/jumio/0?back=true")},children:e(s,{id:"apply_form_declaration_edit"})})]}),className:"p-0 rounded-lg",headerClassName:"px-5",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_upgrade_home_country_num"}),e("span",{className:"w-2/4 text-xs text-right",children:l.homeCountryIdNumber})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_email"}),e("span",{className:"w-2/4 text-xs text-right",children:l.email})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_mobile_phone"}),e("span",{className:"w-2/4 text-xs text-right",children:l.mobile})]})]})}),e(z,{title:r("div",{className:"flex justify-between items-center text-sm",children:[e(s,{id:"apply_upgrade_address_info"}),e(q,{color:"primary",fill:"none",className:"text-xs font-normal",onClick:()=>{d("/jumio/1?back=true")},children:e(s,{id:"apply_form_declaration_edit"})})]}),className:"p-0 rounded-lg ",headerClassName:"px-5",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_residential_addr"}),e("span",{className:"w-2/4 text-xs text-right",children:i(l==null?void 0:l.residentAddress)})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_mailing_addr"}),e("span",{className:"w-2/4 text-xs text-right",children:i(l==null?void 0:l.billingAddress)})]})]})}),e(z,{title:r("div",{className:"flex justify-between items-center text-sm",children:[e(s,{id:"apply_upgrade_other_info"}),e(q,{color:"primary",fill:"none",className:"text-xs font-normal",onClick:()=>{d("/jumio/2-1?back=true")},children:e(s,{id:"apply_form_declaration_edit"})})]}),className:"p-0 rounded-lg ",headerClassName:"px-5",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_self_employed"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:l.selfEmployment})]}),l.selfEmployment==="N"&&r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_employer"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:l.companyName})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_job_industry"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:ie("JOB_INDUSTRY",l.jobIndustry)})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_occupation"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:ie("PROFESSION",l.profession)})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_length_of_employment_b"}),r("span",{className:"w-2/4 text-xs text-right capitalize",children:[l.serviceYears,t("apply_form_years"),"  ",l.serviceMonths,t("apply_form_months")]})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_gross_annual_income"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:e(Te,{value:Number(l.incomeYear)/100,style:"currency",currency:"SGD"})})]})]})}),["identityFiles","passportFiles","incomeProofFiles","addressProofFiles","studentIdFiles","parentConsentFiles","otherDetailsFiles"].find(m=>{var S;return l&&((S=l[m])==null?void 0:S.length)})&&e(z,{title:r("div",{className:"flex justify-between items-center text-sm",children:[e(s,{id:"apply_form_upload_docs"}),e(q,{color:"primary",fill:"none",className:"text-xs font-normal",onClick:()=>{d("/jumio/2-2?back=true")},children:e(s,{id:"apply_form_declaration_edit"})})]}),className:"p-0 rounded-lg ",headerClassName:"px-5",children:e(U,{direction:"vertical",block:!0,className:"px-5",children:["identityFiles","passportFiles","incomeProofFiles","addressProofFiles","studentIdFiles","parentConsentFiles","otherDetailsFiles"].filter(m=>{var S;return(S=l[m])==null?void 0:S.length}).map(m=>e(mt,{title:t(`apply_manual_upload_${m}`),data:l[m]},m))})}),e(z,{title:r("div",{className:"flex justify-between items-center text-sm",children:[e(s,{id:"apply_form_card_personalization"}),e(q,{color:"primary",fill:"none",className:"text-xs font-normal",onClick:()=>{d("/jumio/3?back=true")},children:e(s,{id:"apply_form_declaration_edit"})})]}),className:"p-0 rounded-lg ",headerClassName:"px-5",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_credit_lit_preference"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:(l==null?void 0:l.determineLimitFlag)==="N"?e(Te,{value:Number(l.preCreditLimit),style:"currency",currency:"SGD"}):e(s,{id:"apply_form_let_dcs_determine"})})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_name_on_card"}),e("span",{className:"w-2/4 text-xs text-right capitalize",children:l.preNameOnCard})]})]})}),e(z,{title:e("div",{className:"flex justify-between items-center text-sm",children:e(s,{id:"apply_jumio_passport"})}),className:"p-0 rounded-lg ",headerClassName:"px-5",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_name"}),e("span",{className:"w-2/4 text-xs text-right",children:`${a==null?void 0:a.idResult.firstName} ${a==null?void 0:a.idResult.lastName}`})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_gender"}),e("span",{className:"w-2/4 text-xs text-right",children:ie("GENDER",a==null?void 0:a.idResult.gender)})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_date_of_birth"}),e("span",{className:"w-2/4 text-xs text-right",children:a!=null&&a.idResult.dateOfBirth?xe(a==null?void 0:a.idResult.dateOfBirth).format("DD MMM YYYY"):""})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_nationality"}),e("span",{className:"w-2/4 text-xs text-right",children:F((f=a==null?void 0:a.idResult)==null?void 0:f.nationality)})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_passport_num"}),e("span",{className:"w-2/4 text-xs text-right",children:a==null?void 0:a.idResult.idNumber})]}),r("div",{className:"flex justify-between items-center",children:[e(N,{className:"text-minor text-xs",id:"apply_form_passport_expiry_date"}),e("span",{className:"w-2/4 text-xs text-right",children:a!=null&&a.idResult.expiryDate?xe(a==null?void 0:a.idResult.expiryDate).format("DD MMM YYYY"):""})]})]})}),e(z,{title:e("div",{children:e(s,{id:"apply_form_declaration_consent_title"})}),children:r(U,{direction:"vertical",block:!0,children:[e(g.Item,{name:"dncFlag",children:e(he,{children:r("p",{className:"ml-3",children:[" ",t("apply_form_declaration_1a")]})})}),e(g.Item,{name:"usaTaxResident",children:e(he,{children:r("p",{className:"ml-3",children:[t("apply_form_declaration_3a"),e("br",{}),t("apply_form_declaration_3b"),e("br",{}),t("apply_form_declaration_3c")]})})}),e(g.Subscribe,{to:["usaTaxResident"],children:({usaTaxResident:m})=>{if(m)return e(g.Item,{label:e(s,{id:"apply_form_declaration_3d"}),name:"usaTaxTin",rules:[{required:!0},{pattern:/^[\w\s]{1,23}$/,message:t("rule_characters",{string:"1-23"})}],children:e(O,{maxLength:23,placeholder:t("apply_form_declaration_3e")})})}}),e(g.Item,{name:"pdpaFlag",rules:[{validator:(m,S)=>S?Promise.resolve():Promise.reject(new Error(t("apply_form_please_check")))}],children:e(he,{children:r("div",{className:"ml-3",children:[e("span",{className:"text-red",children:"*"}),e(s,{id:"apply_form_authorization_text"}),e(s,{id:"apply_form_authorization_text2"}),e(s,{id:"apply_form_dcs_charge_credit1"}),e(s,{id:"apply_form_conditions"}),e(s,{id:"apply_form_application"})]})})})]})})]}):e(M,{})}),mt=({title:l,data:a})=>r("div",{className:"flex text-xs",children:[e("span",{children:l}),e("div",{style:{width:"60%"},children:a==null?void 0:a.map((_,n)=>e("p",{className:"text-blue",children:_.attachedName},n))})]}),ut=y.memo(()=>{const{applayCardDraftDataJumio:l,appliedCards:a}=Y(n=>n.cardApply);console.log("applayCardDraftDataJumio======"+JSON.stringify(l));const _=y.useMemo(()=>{var n;return a[0]&&((n=a[0].productList[0])==null?void 0:n.tenCardsFlag)},[a]);return l?e(z,{headerClassName:"px-5",title:e("div",{children:e(N,{id:"apply_upgrade_occupation_income"})}),className:"p-0 rounded-lg",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[e(g.Item,{name:"selfEmployment",rules:[{required:!0}],initialValue:l.selfEmployment==="Y",children:e(he,{children:e(s,{id:"apply_form_i_am_self_employed"})})}),e(g.Subscribe,{to:["selfEmployment"],children:({selfEmployment:n})=>{if(!n)return e(g.Item,{name:"companyName",label:e(s,{id:"apply_form_employer"}),rules:[{required:!0},{pattern:/^[A-Za-z-_ ]*$/,message:t("rule_alphabets_spaces_hyphens")}],children:e(O,{maxLength:80,autoCapitalize:"characters",placeholder:t("apply_form_please_enter")+t("apply_form_employer")})})}}),e(g.Item,{name:"jobIndustry",label:e(s,{id:"apply_form_job_industry"}),rules:[{required:!0}],initialValue:l.jobIndustry,children:e(ge,{dictType:"JOB_INDUSTRY"})}),e(g.Item,{name:"profession",label:e(s,{id:"apply_form_occupation"}),rules:[{required:!0}],initialValue:l.profession,children:e(ge,{dictType:"PROFESSION"})}),e(g.Item,{name:"yearsWorking",trigger:"onConfirm",label:e(s,{id:"apply_form_length_of_employment"}),rules:[{required:!0}],onClick:(n,d)=>{var i;(i=d.current)==null||i.open()},children:e(ze,{columns:[new Array(99).fill(1).map((n,d)=>({label:`${++d} ${t("apply_form_years")}`,value:d})),new Array(12).fill(1).map((n,d)=>({label:`${d} ${t("apply_form_months")}`,value:d}))],children:n=>r("div",{className:"adm-input flex justify-between",style:{color:n.length?"#25435f":"#909daa",display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e("span",{children:n.length?n.map(d=>d==null?void 0:d.label).join(" "):t("apply_form_please_choose")}),e(rt,{color:"#000",fontSize:12})]})})}),e(g.Item,{name:"incomeYear",label:r("p",{children:[e(s,{id:"apply_form_gross_annual_income"}),"(S$)"]}),rules:[{required:!0},{pattern:/^([1-9]{1}\d*)(\.\d{1,2})?$/,message:t("rule_invalid_input")}],children:e(O,{maxLength:10,autoCapitalize:"characters",placeholder:t("apply_form_please_enter")+t("apply_form_gross_annual_income")})}),l.isAlien==="0"&&!_&&e(g.Item,{name:"empPassExpiryDate",label:e(s,{id:"apply_form_employment_pass_expiry"}),trigger:"onConfirm",onClick:(n,d)=>{var i;(i=d.current)==null||i.open()},rules:[{required:!0}],initialValue:l.empPassExpiryDate?new Date(l.empPassExpiryDate):void 0,children:e(ot,{children:n=>e("div",{className:`adm-input ${n?"text-default":"text-minor"}`,children:n?e(je,{value:n}):t("apply_form_please_enter")+t("apply_form_employment_pass_expiry")})})})]})}):e(M,{})}),_t=y.memo(()=>{var C;const l=Y(p=>p.user),{applayCardDraftDataJumio:a,appliedCards:_}=Y(p=>p.cardApply),[n,d]=y.useState(a==null?void 0:a.preNameOnCard),i=_[0]&&((C=_[0].productList[0])==null?void 0:C.fixedLimit)==="1",F=p=>{d(p.toLocaleUpperCase())};return a?r("div",{children:[!i&&e(z,{headerClassName:"px-5",title:e("div",{children:e(N,{id:"apply_form_credit_lit_preference"})}),className:"p-0 rounded-lg",children:r(U,{direction:"vertical",block:!0,className:"px-5",children:[e(g.Item,{name:"determineLimitFlag",rules:[{required:!0}],initialValue:"Y",children:e(re.Group,{children:r(U,{direction:"vertical",children:[e(re,{value:"Y",children:e(s,{id:"apply_form_let_dcs_determine"})}),e(re,{value:"N",children:e(s,{id:"apply_form_set_my_preferred_limit"})})]})})}),e(g.Subscribe,{to:["determineLimitFlag"],children:({determineLimitFlag:p})=>{if(console.log("determineLimitFlag",p),p!=="Y")return r("div",{className:"mt-10",children:[e(g.Item,{name:"preCreditLimit",rules:[{required:!0}],initialValue:1,children:e(it,{residentPopover:!0,step:1,max:150,min:1,popover:f=>e("span",{children:f*1e3}),icon:e(ht,{})})}),r("div",{className:"flex justify-between text-xs",children:[e("span",{children:"S$ 1,000"}),e("span",{children:"S$ 150,000"})]}),e(N,{className:"text-xs text-minor mx-6 my-6 text-center",id:"apply_form_credit_limit_tip"})]})}})]})}),e(z,{headerClassName:"px-5 ",title:e("div",{children:e(N,{id:"apply_form_name_on_card"})}),className:"p-0 rounded-lg mt-4",children:r("div",{className:"px-5",children:[e(g.Item,{name:"preNameOnCard",label:e(s,{id:"apply_form_embossed_name"}),rules:[{required:!0}],initialValue:a==null?void 0:a.preNameOnCard,children:e(O,{maxLength:19,minLength:2,autoCapitalize:"characters",onChange:F})}),_.map(p=>{let f=l.sdkData.productInfo.find(m=>m.productCode===p.productList[0].productCode);return r("div",{className:"mt-5 relative",children:[e(ce,{src:f&&f.cardFace?f.cardFace:p.channelCardShowImage,alt:p.channelCardName}),e("span",{style:{position:"absolute",bottom:0,left:0},className:"text-base font-medium text-white pl-5 pb-5",children:l!=null&&l.showCardNameMaskOnCardFlag?n:""})]},p.channelCreditCardId)})]})})]}):e(M,{})}),ht=()=>r("svg",{width:"38",height:"18",viewBox:"0 0 38 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e("rect",{x:"0.5",y:"0.5",width:"37",height:"17",rx:"8.5",fill:"#3366FF",stroke:"#E3FAFF"}),e("rect",{x:"16",y:"4",width:"10",height:"2",rx:"1",transform:"rotate(90 16 4)",fill:"#ACF0FF"}),e("rect",{x:"20",y:"4",width:"10",height:"2",rx:"1",transform:"rotate(90 20 4)",fill:"#ACF0FF"}),e("rect",{x:"24",y:"4",width:"10",height:"2",rx:"1",transform:"rotate(90 24 4)",fill:"#ACF0FF"})]});const gt="/static/uploadExample-b941204b.png",yt=()=>{var w;const{postcodeGetAddress:l,uploadButtonVisible:a,cameraPageCountry:_,uploadLoading:n,postAddressDetailsHiding:d,applayCardDraftDataJumio:i,addressDetailsHiding:F}=Y(u=>u.cardApply),[C,p]=y.useState(!1),f=me();console.log(">>>>>>>>>>>>>>>",i);const[m,S]=y.useState(!1),[B,o]=y.useState(""),[E,c]=y.useState(!1),[L,D]=y.useState(!1),[A,T]=y.useState(""),[R,I]=y.useState(""),$=Ae(),P=y.useRef(null);console.log("uploadButtonVisible状态是什么",a,n);const V=u=>{let k="";u=="reside"?(c(!0),k=A):(D(!0),k=R),K("/dcs-apply-online/card/apply/utils/addressLookup",{postalCode:k}).then(v=>{u=="reside"?(f(Ke(v.address)),f(Oe(!0))):(f(Qe(v.address)),f(Ze(!0)))}).finally(()=>{c(!1),D(!1)})},H=()=>{console.log("childRef.current",P.current),P.current&&P.current.onOpen()};return i?e("div",{children:r("div",{children:[e(z,{title:r("div",{children:[e(s,{id:"apply_form_residential_addr"}),e(N,{className:"font-normal text-xs text-minor",id:"apply_upgrade_header_tip"})]}),className:"p-0 rounded-lg shadow-lg bg-white",headerClassName:"px-5",children:r("div",{children:[e(g.Item,{className:"formItemCustom",name:["residentAddress","country"],label:e(s,{id:"apply_form_property_country"}),rules:[{required:!0}],initialValue:((w=i.residentAddress)==null?void 0:w.country)||((i==null?void 0:i.nationality)=="CHN"?"CN":"SG"),children:e(ge,{dictType:"COUNTRY_CODE_ISO2"})}),e(g.Subscribe,{to:["residentAddress","country"],children:({residentAddress:u})=>{var k,v,G,j,ee,Q,te,le;return console.log("表单变化了",u,_),T(u==null?void 0:u.postal),o(u==null?void 0:u.country),_&&(u==null?void 0:u.country)!=_&&f(W(!0)),(u==null?void 0:u.country)!="CN"?r(M,{children:[e("div",{className:"my-3 text-sm",children:t("upload_address_file_sg")}),r("div",{className:"leading-6 text-xs",children:[e("p",{className:"text-[#909DAA] ",children:t("upload_address_file_sg_desc1")}),e("p",{className:"text-[#909DAA] ",children:t("upload_address_file_sg_desc2")})]}),a&&e(q,{loading:n,loadingText:t("jumio_uploading_title"),className:"mt-3 w-44 bg-[#36f] text-[#FFF] text-sm",onClick:()=>S(!0),children:t("upload_address_file_sg_btn")}),e(Pe,{ref:P,turnOnTheCamera:B}),!a&&(u==null?void 0:u.country)=="SG"&&r("div",{style:{position:"relative"},children:[e(g.Item,{name:["residentAddress","postal"],label:e(s,{id:"apply_form_postal_code"}),rules:[{required:!0},{pattern:/^[0-9]{6,6}$/,message:t("rule_digits",{string:6})}],initialValue:(k=i.residentAddress)==null?void 0:k.postal,children:e(O,{type:"number",placeholder:t("apply_form_please_enter")+t("apply_form_postal_code")})}),e(q,{color:"primary",loading:E,onClick:()=>V("reside"),style:{position:"absolute",right:"10px",top:"43px",width:"100px",height:"32px",fontSize:"14px",padding:"0 0 0.5px 0"},children:t("apply_form_geturl")})]}),F&&(u==null?void 0:u.country)=="SG"&&r(M,{children:[e(g.Item,{name:["residentAddress","block"],label:e(s,{id:"apply_form_block"}),rules:[{required:!0},{pattern:/^[\w\s]{1,10}$/,message:t("rule_characters",{string:"1-10"})}],initialValue:(v=i.residentAddress)==null?void 0:v.block,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_block")})}),e(g.Item,{name:["residentAddress","street"],label:e(s,{id:"apply_form_street_name"}),rules:[{required:!0},{pattern:/^[\w\s]{1,66}$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(G=i.residentAddress)==null?void 0:G.street,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_street_name")})}),e(g.Item,{name:["residentAddress","floor"],label:e(s,{id:"apply_upgrade_floor_name"}),rules:[{required:!0},{pattern:/^[A-Za-z0-9]{1,5}$/,message:t("rule_characters",{string:"1-5"})}],initialValue:(j=i.residentAddress)==null?void 0:j.floor,help:e(s,{id:"apply_upgrade_input_tip"}),children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_upgrade_floor_name")})}),e(g.Item,{name:["residentAddress","unit"],label:e(s,{id:"apply_form_unit"}),rules:[{required:!0},{pattern:/^[0-9]{1,5}$/,message:t("rule_digits",{string:"1-5"})}],initialValue:(ee=i.residentAddress)==null?void 0:ee.unit,help:e(s,{id:"apply_upgrade_input_tip2"}),children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_unit")})}),e(g.Item,{name:["residentAddress","building"],label:e(s,{id:"apply_form_building"}),rules:[{pattern:/^[\w\s]{1,66}$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(Q=i.residentAddress)==null?void 0:Q.building,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_building")})})]}),(u==null?void 0:u.country)!="SG"&&!a&&e(g.Item,{name:["residentAddress","line1"],label:e(s,{id:"apply_form_permanent_home_addr"}),rules:[{required:!0},{pattern:/^[a-zA-Z0-9 ,.\-#]+$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(te=i.residentAddress)==null?void 0:te.block,children:e(fe,{showCount:!0,maxLength:200,placeholder:t("apply_form_please_enter")+t("apply_form_permanent_home_addr")})})]}):r(M,{children:[e("div",{className:"mt-3 text-sm",children:t("upload_address_file_sg")}),r("div",{className:"text-[#909DAA] text-sm leading-6",children:[t("upload_address_file_zh_desc1"),e("span",{className:"text-[#25435F] text-sm underline",children:t("upload_address_file_zh_desc2")}),t("upload_address_file_zh_desc3")]}),a&&e(q,{loading:n,loadingText:t("jumio_uploading_title"),className:"mt-3 w-44 bg-[#36f] text-[#FFF] mb-3 text-sm",onClick:()=>S(!0),children:t("upload_address_file_zh_btn")}),e(Pe,{ref:P,turnOnTheCamera:B}),!a&&e(g.Item,{name:["residentAddress","line1"],label:e(s,{id:"apply_form_permanent_home_addr"}),rules:[{required:!0},{pattern:/^[a-zA-Z0-9 ,.\-#]+$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(le=i.residentAddress)==null?void 0:le.block,children:e(fe,{showCount:!0,maxLength:200,placeholder:t("apply_form_please_enter")+t("apply_form_permanent_home_addr")})})]})}})]})}),e(z,{title:r("div",{children:[e(s,{id:"apply_form_mailing_addr"}),e(N,{className:"font-normal text-xs text-minor",id:"apply_upgrade_mailing_address_tip1"}),e(N,{className:"font-normal text-xs text-minor",id:"apply_upgrade_mailing_address_tip3"})]}),className:"mt-5 p-0 rounded-lg shadow-lg bg-white",headerClassName:"px-5",children:r(U,{direction:"vertical",className:"px-5",block:!0,children:[e(g.Item,{initialValue:"Y",name:"sameResidentialFlag",rules:[{required:!0}],children:e(re.Group,{onChange:u=>{u==="N"&&(p(!0),f(He(!1)))},children:r(U,{children:[e(re,{value:"Y",children:e(s,{id:"apply_form_same_as_residential_addr"})}),e(re,{value:"N",children:e(s,{id:"apply_upgrade_other_addresses"})})]})})}),e($e,{visible:C,content:t("mailing_address_other_tips"),closeOnAction:!0,onClose:()=>{p(!1)},actions:[{key:"confirm",text:t("confirm_switching_address")}]}),e(g.Subscribe,{to:["sameResidentialFlag"],children:({sameResidentialFlag:u})=>(console.log("sameResidentialFlag",u),e(M,{children:e(g.Subscribe,{to:["billingAddress","country"],children:({billingAddress:k})=>{var v,G,j,ee,Q,te,le,x;return I(k==null?void 0:k.postal),u==="Y"?r(M,{children:[r("div",{style:{position:"relative"},children:[e(g.Item,{name:["billingAddress","postal"],label:e(s,{id:"apply_form_postal_code"}),rules:[{required:!0},{pattern:/^[0-9]{6,6}$/,message:t("rule_digits",{string:6})}],initialValue:(v=i.billingAddress)==null?void 0:v.postal,children:e(O,{type:"number",placeholder:t("apply_form_please_enter")+t("apply_form_postal_code")})}),e(q,{color:"primary",loading:L,onClick:()=>V("post"),style:{position:"absolute",right:"10px",top:"43px",width:"100px",height:"32px",fontSize:"14px",padding:"0 0 0.5px 0"},children:t("apply_form_geturl")})]}),d&&r(M,{children:[e(g.Item,{name:["billingAddress","street"],label:e(s,{id:"apply_form_street_name"}),rules:[{required:!0},{pattern:/^[\w\s]{1,66}$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(G=i.billingAddress)==null?void 0:G.street,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_street_name")})}),e(g.Item,{name:["billingAddress","block"],label:e(s,{id:"apply_form_block"}),rules:[{required:!0},{pattern:/^[\w\s]{1,10}$/,message:t("rule_characters",{string:"1-10"})}],initialValue:(j=i.billingAddress)==null?void 0:j.block,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_block")})}),e(g.Item,{name:["billingAddress","floor"],label:e(s,{id:"apply_upgrade_floor_name"}),rules:[{required:!0},{pattern:/^[A-Za-z0-9]{1,5}$/,message:t("rule_characters",{string:"1-5"})}],initialValue:(ee=i.billingAddress)==null?void 0:ee.floor,help:e(s,{id:"apply_upgrade_input_tip"}),children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_upgrade_floor_name")})}),e(g.Item,{name:["billingAddress","unit"],label:e(s,{id:"apply_form_unit"}),rules:[{required:!0},{pattern:/^[0-9]{1,5}$/,message:t("rule_digits",{string:"1-5"})}],initialValue:(Q=i.billingAddress)==null?void 0:Q.unit,help:e(s,{id:"apply_upgrade_input_tip2"}),children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_unit")})}),e(g.Item,{name:["billingAddress","building"],label:e(s,{id:"apply_form_building"}),rules:[{pattern:/^[\w\s]{1,66}$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(te=i.billingAddress)==null?void 0:te.building,children:e(O,{placeholder:t("apply_form_please_enter")+t("apply_form_building")})})]})]}):r(M,{children:[e(g.Item,{name:["billingAddress","country"],label:e(s,{id:"apply_form_property_country"}),rules:[{required:!0}],initialValue:((le=i.billingAddress)==null?void 0:le.country)||"CN",children:e(ge,{dictType:"COUNTRY_CODE_ISO2",nonSingapore:!0})}),e(g.Item,{name:["billingAddress","line1"],label:e(s,{id:"apply_form_permanent_home_addr"}),rules:[{required:!0},{pattern:/^[a-zA-Z0-9 ,.\-#]+$/,message:t("rule_alphabets_numbers_spaces")}],initialValue:(x=i.billingAddress)==null?void 0:x.block,children:e(fe,{showCount:!0,maxLength:200,placeholder:t("apply_form_please_enter")+t("apply_form_permanent_home_addr")})})]})}})}))})]})}),r(Ge,{visible:m,showCloseButton:!0,bodyStyle:{borderTopLeftRadius:"8px",borderTopRightRadius:"8px",minHeight:"40vh",paddingLeft:"10px",paddingRight:"10px",paddingBottom:"50px"},onMaskClick:()=>{S(!1)},onClose:()=>{S(!1)},children:[e("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"10px",fontWeight:"700",fontSize:"16px"},children:t("apply_guide_select_upload_method")}),e("div",{style:{backgroundColor:"#F6F8FB",minHeight:"100px",marginTop:"10px",display:"flex",flexDirection:"column",justifyContent:"space-around",padding:"20px 15px"},children:r("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[e("div",{children:e(ce,{src:gt})}),r("div",{className:"leading-7 mt-3",children:[e("p",{children:t("orcDangerTips1")}),e("p",{children:t("orcDangerTips2")}),e("p",{children:t("orcDangerTips3")})]})]})}),r("div",{style:{display:"flex",flexDirection:"column",marginTop:"20px"},children:[e(q,{color:"primary",fill:"none",onClick:()=>{S(!1),f(W(!1)),$("/jumio/12",{state:{certificate:B}})},children:t("apply_guide_take_picture")}),e(q,{color:"primary",fill:"none",onClick:()=>{S(!1),H()},children:t("apply_guide_upload_album")}),e(q,{color:"primary",shape:"rounded",className:"mt-4",onClick:()=>S(!1),children:t("cant_apply_physical_card_dialog_cancle")})]})]})]})}):e(M,{})},Pe=y.forwardRef((l,a)=>{y.useRef();const _=y.useRef(null),{turnOnTheCamera:n,switchingaddressDetailsHiding:d}=l;y.useState(!0);const{applayCardDraftDataJumio:i,channelApplyNo:F,uploadButtonVisible:C,addressCcertificate:p}=Y(A=>A.cardApply),f=me(),[m,S]=y.useState([]);y.useEffect(()=>{p&&S([{url:p}])},[p]);const B=(A,T)=>{K("/dcs-apply-online/card/apply/utils/externalOcr",{channelApplyNo:F,attachedType:"3",base64Image:A,ocrRequestType:"CHECK_ADDRESS",docType:"library",attachedName:"dcs-apply-online/"+T}).then(R=>{if(console.log("相册验证",R),n==="CN"&&R.ocrAddressResult==="F"&&R.ocrIdentifyType==="CHINA_ID")return ye.show({content:t("uploadd_ocr_fail"),afterClose:()=>{console.log("after")}}),!1;f(de(n)),f(Ne(R)),f(W(!1))}).finally(()=>{f(be(!1))})};function o(A,T){console.log("beforeUpload",A,T),f(be(!0));const R=new FileReader;R.onload=P=>X(this,null,function*(){const V=P.target.result;try{const u=(yield E(V)).split(",")[1];B(u,A.name)}catch(H){console.error("图片压缩出错:",H)}}),R.readAsDataURL(A);const I=10*1024,$=10*1024*1024;return A.size<I?(ye.show(t("file_is_too_small")),null):A.size>$?(ye.show(t("apply_form_accept_formats")),null):A}function E(A,T=500,R=.3){return new Promise((I,$)=>{const P=new Image;P.src=A,P.onload=()=>{const V=document.createElement("canvas"),H=V.getContext("2d");let w=P.width,u=P.height;w>T&&(u=T/w*u,w=T),V.width=w,V.height=u,H.drawImage(P,0,0,w,u);const k=V.toDataURL("image/jpeg",R);I(k)},P.onerror=V=>{$(V)}})}const c=(A,T)=>X(void 0,null,function*(){console.log("------------file文件名",A);try{const R=yield K("/dcs-apply-online/card/apply/fileUpload",{channelApplyNo:F,attachedType:3,fileSuffix:A.type.split("/")[1],attachedName:A.name});console.log("imageUpload",R),new FormData().append("file",A);const $=yield Ee.put(R.imageTempUrl,A,{headers:{"Content-Type":A.type}});return{key:A.name+Math.random(),url:URL.createObjectURL(A),extra:R.attachedImage}}catch(R){throw console.log("errr",R),new Error("error")}}),L=A=>X(void 0,null,function*(){if(console.log("文件列表更新：",A),A.length>1){const T=A[1];console.log("处理后文件列表更新：",T),S([T]),f(pe(T.url))}else S(A),f(pe(A[0].url))}),D=()=>{var T;const A=(T=_.current)==null?void 0:T.nativeElement;A&&A.click()};return y.useImperativeHandle(a,()=>({onOpen:D})),e("div",{style:{display:C?"none":"block",margin:"20px 0"},children:e(ct,{ref:_,value:m,onChange:L,upload:c,maxCount:2,showUpload:!1,beforeUpload:o,onDelete:A=>{f(W(!0)),f(Oe(!1))}})})}),ft=y.memo(()=>{var p,f,m,S,B,o,E;const{applayCardDraftDataJumio:l,appliedCards:a}=Y(c=>c.cardApply);Y(c=>c.user),console.log("90909090909090",a,l);let _=(p=l==null?void 0:l.addressProofFiles)==null?void 0:p.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()}));(f=l==null?void 0:l.passportFiles)==null||f.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()}));let n=(m=l==null?void 0:l.identityFiles)==null?void 0:m.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()})),d=(S=l==null?void 0:l.incomeProofFiles)==null?void 0:S.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()}));(B=l==null?void 0:l.otherDetailsFiles)==null||B.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()}));let i=(o=l==null?void 0:l.studentIdFiles)==null?void 0:o.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()})),F=(E=l==null?void 0:l.parentConsentFiles)==null?void 0:E.map(c=>({url:"https://cardsminio.dcscc.com"+c.attachedImage,extra:c.attachedImage,key:c.attachedImage+Math.random()}));console.log("addressProofFiles",_);const C=y.useMemo(()=>{var c;return a[0]&&((c=a[0].productList[0])==null?void 0:c.tenCardsFlag)},[a]);return l?e("div",{className:"pt-3",children:r(z,{headerClassName:"px-5",className:"p-0 rounded-lg",children:[l.isAlien=="1"&&!C?e(g.Item,{className:"upload-box",name:"identityFiles",initialValue:l.identityFiles,rules:[{required:!0,message:t("apply_form_please_upload")}],label:r("div",{children:[e(N,{className:"font-bold text-sm mb-2",id:"apply_manual_upload_your_id_document"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_guide_id_tip"})]}),children:e(oe,{attachedType:1,maxCount:2,value:n})}):null,!C&&r(U,{direction:"vertical",block:!0,style:{background:"rgb(246, 248, 251)"},children:[e(g.Item,{name:"incomeProofFiles",required:!0,rules:[{required:!0,message:t("apply_form_please_upload")}],label:r("div",{children:[e(N,{className:"font-bold text-sm mb-2",id:"apply_manual_upload_incomeProofFiles"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_guide_proof_income_tip"})]}),className:"upload-box",children:e(oe,{attachedType:2,maxCount:3,value:d})}),l.profession=="1191"&&e(g.Item,{name:"studentIdFiles",rules:[{required:!0,message:t("apply_form_please_upload")}],initialValue:l.studentIdFiles,label:r("div",{children:[e(N,{className:"font-bold text-sm mb-2",id:"apply_manual_upload_studentIdFiles"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_guide_student"})]}),className:"upload-box",children:e(oe,{attachedType:4,maxCount:1,value:i})}),Number(l==null?void 0:l.age)<21&&e(g.Item,{name:"parentConsentFiles",rules:[{required:!0,message:t("apply_form_please_upload")}],initialValue:l.studentIdFiles,label:r("div",{children:[e(N,{className:"font-bold text-sm mb-2",id:"apply_manual_upload_parentConsentFiles"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_manual_upload_parent"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_guide_parent_example"})]}),className:"upload-box",children:e(oe,{attachedType:5,maxCount:1,value:F})})]}),e(g.Item,{className:"upload-box",name:"addressProofFiles",initialValue:l.addressProofFiles,label:r("div",{className:"",children:[e(N,{className:"font-bold text-sm mb-2",id:"apply_manual_upload_addressProofFiles"}),l.isAlien==="1"&&e(N,{className:"text-minor text-xs",id:"apply_guide_proof_address_tip1"}),e(N,{className:"text-minor text-xs mb-2",id:"apply_guide_proof_address_tip2"})]}),rules:[{required:!0,message:t("apply_form_please_upload")}],getValueFromEvent:c=>c,children:e(oe,{attachedType:3,maxCount:3,value:_})})]})}):e(M,{})}),xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAQCAYAAAAbBi9cAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADsSURBVHgBpVSBEYIwDEw9B2ADOwIbiBPoBjKCG+gIbCAbeE4gG+AG4ATgBDWRwOVyuaMHf5dL2rTffENxIYQEAHI08kvQolUOiV4YZLAOf6KgJnu0JwwVHiESWzVu0Q7OOfKAZ6ToapH/GBw74MUSF72KpHOuM0goX1ByC/P4sk+YrFd5b1VUcxfHnA+RAGOuIYloV6rAyKcx0saOjeVTfFZrHrivFeNUSyulLCWvCZHSGotEkGVq340P8FzARFTADMLQCHmPd7ZO3tEe43yGS1bsYXifE6wnsggbtArW400VeQxOsPw3Qp9K+QO87FTcxB1oCwAAAABJRU5ErkJggg==",bt="data:image/png;base64,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",Nt="/static/IdFrame-8312bac0.png";const At=l=>{var V,H;console.log(l);const a=me(),{applayCardDraftDataJumio:_,channelApplyNo:n}=Y(w=>w.cardApply);Y(w=>w.user);const d=document.querySelector(".pagebox");(V=d==null?void 0:d.style)==null||V.setProperty("--pagebox-bg","transparent");const F=(H=Le().state)==null?void 0:H.certificate,[C,p]=y.useState(""),[f,m]=y.useState(""),[S,B]=y.useState(!1),[o,E]=y.useState(!1),c=window.screen.height/2;let L={x:0,y:150,width:window.screen.width,height:c,camera:CameraPreview.CAMERA_DIRECTION.BACK,toBack:!0,tapPhoto:!0,tapFocus:!1,previewDrag:!1,storeToFile:!1,disableExifHeaderStripping:!1};const D=()=>{CameraPreview.startCamera(L)};function A(w){return w.replace(/[^a-zA-Z0-9]/g,"").slice(0,32)}function T(w,u){const k=w,v=new ArrayBuffer(k.length),G=new Uint8Array(v);for(let j=0;j<k.length;j++)G[j]=k.charCodeAt(j);return new Blob([v],{type:u})}const R="image/jpeg",I=(w,u,k)=>X(void 0,null,function*(){console.log("------------",w);try{const v=yield K("/dcs-apply-online/card/apply/fileUpload",{channelApplyNo:n,attachedType:"3",fileSuffix:u.split("/")[1],attachedName:k});return Ee.put(v.imageTempUrl,w,{headers:{"Content-Type":u}}),{key:k+Math.random(),url:URL.createObjectURL(w),extra:v.attachedImage}}catch(v){throw console.log("errr",v),new Error("error")}}),$=()=>{S||(a(Ne("")),CameraPreview.takePicture({width:640,height:640,quality:25},function(w){if(console.log("图片",w[0]),w.length<=0)return;const u=A(w[0])+".jpg";console.log("图片名称是什么",u);const k=T(w[0],R);m("data:image/jpeg;base64,"+w[0]),a(pe("data:image/jpeg;base64,"+w[0])),B(!0),console.log("dcs-apply-online/card/apply/utils/externalOcr--------------------------",f),K("/dcs-apply-online/card/apply/utils/externalOcr",{channelApplyNo:n,attachedType:"3",base64Image:w[0],ocrRequestType:"CHECK_ADDRESS",docType:C,attachedName:"dcs-apply-online/"+u}).then(v=>{if(a(W(!1)),a(de(F)),B(!1),CameraPreview.stopCamera(),window.history.back(),console.log("certificate是什么",F,v),F==="CN"&&v.ocrAddressResult==="F"&&v.ocrIdentifyType==="CHINA_ID"){console.log("身份证验证失败");return}if(F==="CN"&&v.ocrAddressResult==="F"){I(k,"image/jpeg","image.jpg");return}if(F!=="CN"&&v.ocrAddressResult==="F"){I(k,"image/jpeg","image.jpg");return}a(Ne(v))}).catch(v=>{console.log("错误是什么",v),a(W(!0)),a(de(F)),B(!1),CameraPreview.stopCamera(),window.history.back()})}))},P=()=>X(void 0,null,function*(){a(W(!0)),yield CameraPreview.stopCamera(),window.history.back()});return console.log("afterRequest是什么123",o),y.useEffect(()=>(E(!1),a(pe("")),F!="CN"?p(""):p("chinaIDcardFiles"),D(),()=>{a(de(F)),CameraPreview.stopCamera(),d==null||d.style.setProperty("--pagebox-bg","rgb(255,255,255)")}),[]),y.useEffect(()=>()=>{o||a(W(!0))},[o]),r(M,{children:[e("div",{className:"pl-3 text-base",onClick:()=>{P()},children:e(We,{color:"#FFF"})}),e("div",{className:"text-center text-[#FFF] mt-3",children:t("camera_desc")}),S?r("div",{style:{width:"100%",color:"#fff",position:"absolute",top:"50%",left:"0",textAlign:"center",fontSize:"16px"},children:[e(De,{color:"currentColor"}),e("span",{children:t("apply_guide_camera_successful")})]}):null,C==="chinaIDcardFiles"&&F=="CN"?e("div",{className:"w-full",style:{position:"relative",top:"150px"},children:e("div",{className:"mx-3 my-auto",children:e(ce,{src:Nt})})}):null,r("div",{className:"h-52 w-full flex flex-col  items-center absolute bottom-0",children:[e("div",{className:"w-full h-12 mb-3",children:F=="CN"?r("div",{className:"w-36 h-10 my-3 mx-auto bg-[#000] text-[#FFF] flex justify-evenly items-center rounded",onClick:()=>p(C=="chinaIDcardFiles"?"chinaOtherFiles":"chinaIDcardFiles"),children:[e(ce,{src:xt,width:15}),C=="chinaIDcardFiles"?t("toogle_to_idcard_files"):t("toogle_to_other_files")]}):null}),e(q,{onClick:()=>{E(!0),$()},className:"PhotoBtn rounded-full",children:e(ce,{src:bt})})]})]})},Bt=y.memo(()=>{const l=Ae(),a=me(),[_]=g.useForm();Le();const[n]=Je(),d=Xe(),{userInfo:i,sdkData:F}=Y(x=>x.user),{appliedCardsFlat:C,channelApplyNo:p,applyExtraParms:f,appliedCards:m,applayCardDraftDataJumio:S,jumioWorkflowData:B,jumioInfoData:o,addressInformationIsDisplayed:E,residentialAddressInfo:c,postcodeGetAddress:L,addressCcertificate:D}=Y(x=>x.cardApply),A=Y(x=>x.app.locale),[T,R]=y.useState(),[I,$]=y.useState(parseInt(d.id||"")),[P,V]=y.useState(!0),[H,w]=y.useState(!1),[u,k]=y.useState(!1),[v,G]=y.useState(""),j=y.useMemo(()=>{var x;return m[0]&&((x=m[0].productList[0])==null?void 0:x.tenCardsFlag)},[m]),ee=(x,b)=>(_.setFieldValue("otp",x),_.setFieldValue("otpPrefix",b),Q(_.getFieldsValue(!0),!0));y.useEffect(()=>{E&&(console.log("赋值地址",E),_.setFieldsValue({residentAddress:{line1:(E==null?void 0:E.ocrAddressInfoEN)||""}}))},[E]),y.useEffect(()=>{console.log("子组件设置居住地址",c),_.setFieldsValue({residentAddress:{block:(c==null?void 0:c.building_number)||"",street:(c==null?void 0:c.street)||"",building:(c==null?void 0:c.building_name)||""}})},[c]),y.useEffect(()=>{console.log("子组件设置邮件地址",L),_.setFieldsValue({billingAddress:{block:(L==null?void 0:L.building_number)||"",street:(L==null?void 0:L.street)||"",building:(L==null?void 0:L.building_name)||""}})},[L]);const Q=(x,b)=>X(void 0,null,function*(){console.log("llllllllllllllllllllllllllllllllllllll",x),w(!0);const h=_e(ae({stepNo:I+1,channelApplyNo:B==null?void 0:B.applyNo,myinfoApplyNo:"",applicationType:4,cardAndProductList:C,mobile:void 0,orgCode:i==null?void 0:i.orgCode},le(I,x)),{cardSdkExternalParam:F});let se=(i==null?void 0:i.areaCode)+" "+(i==null?void 0:i.phoneNumber);if(!b&&h.stepNo===1&&h.mobile!==se)return h.mobile&&G(h.mobile),w(!1),k(!0);G(se),console.log("缓存数据前",h);try{const J=yield K("/dcs-apply-online/card/apply/login/saveApplication/jumio",h);if(!J)return;if(J.applyCardsFlag){R(J.applyCards);return}if(R(void 0),k(!1),a(et(J.channelApplyNo)),h.stepNo===6)yield K("/dcs-apply-online/card/apply/login/sumbitApplication/v5",_e(ae({},f),{jumioAccountId:o==null?void 0:o.accountId,jumioWorkflowExecutionId:o==null?void 0:o.workflowId,channelApplyNo:p,myinfoApplyNo:"",applicationType:4})),l("/result-page",{replace:!0});else{const{back:ue}=Object.fromEntries(n.entries());if(ue)return l(-1);if(console.log("顺序调整确认",I,d.id),h.stepNo===12)return;console.log("相机页面怎么样","1"+h.stepNo,"2"+I,"3"+d.id),I===1?l("/jumio/2-1"):d.id=="2-1"||d.id=="2-2"?x.yearsWorking?l("/jumio/2-2"):l("/jumio/3"):l(`/jumio/${I+1}`)}}catch(J){return Promise.reject()}finally{w(!1)}}),te=()=>X(void 0,null,function*(){V(!0),console.log("init - channelApplyNo",p);let x=ae({},S);try{if(!p&&I===0){const b=yield K("/dcs-apply-online/card/apply/login/queryLastestApplication",{applicationType:4});b!=null&&b.channelApplyNo?x=yield K("/dcs-apply-online/card/apply/login/queryApplicationbyStep/v4",{channelApplyNo:b.channelApplyNo,myinfoApplyNo:"",applicationType:4,cardAndProductList:C}):x.mobile=`${i==null?void 0:i.areaCode} ${i==null?void 0:i.phoneNumber}`}else if(p){const b=yield K("/dcs-apply-online/card/apply/login/queryApplicationbyStep/v4",{channelApplyNo:p,myinfoApplyNo:"",applicationType:4,cardAndProductList:C});x=Object.assign(x,b),console.log("form数据怎样回显",x,b,E)}}catch(b){}return V(!1),x.residentialStatus=x.residentialStatus||(A==="en-SG"?"C":"A"),x.isAlien=["C","P"].includes(x.residentialStatus||"")?"1":"0",console.log("获取到的数据",x),a(tt(x)),x}),le=(x,b)=>{var se,J,ue,Ce,we,Fe,Se,ke,ve;const h=ae({},b);return console.log("urlParams.id========="+d.id,S),console.log("stepNo========="+x),console.log("isHundred========="+j),console.log("value =========",b),Object.keys(b).forEach(Z=>{b[Z]&&typeof b[Z]=="string"&&Z!="otpPrefix"&&(h[Z]=b[Z].toLocaleUpperCase())}),x===0?(a(de(void 0)),a(pe("")),console.log("这里还有照片吗",D),a(W(!0)),h.cardIssuer="G",h.salesStaff=(f==null?void 0:f.staff_id)||"",h.location=(f==null?void 0:f.location)||"",h.mobile=`${b.mobile.areaCode} ${b.mobile.phone}`,h.residentialStatus="A",h.passport=((se=o==null?void 0:o.idResult)==null?void 0:se.idNumber)||"",h.custName=(J=o==null?void 0:o.idResult)!=null&&J.firstName?((ue=o==null?void 0:o.idResult)==null?void 0:ue.lastName)+" "+((Ce=o==null?void 0:o.idResult)==null?void 0:Ce.firstName):"",h.birthDate=(we=o==null?void 0:o.idResult)==null?void 0:we.dateOfBirth,h.jumioAccountId=o==null?void 0:o.accountId,h.jumioWorkflowExecutionId=o==null?void 0:o.workflowId,h.nationality=(Fe=o==null?void 0:o.idResult)==null?void 0:Fe.nationality,h.gender=(Se=o==null?void 0:o.idResult)==null?void 0:Se.gender,h.nationality=(ke=o==null?void 0:o.idResult)==null?void 0:ke.nationality,h.passportExpiryDate=(ve=o==null?void 0:o.idResult)==null?void 0:ve.expiryDate,h.jumioSdkIdResult=Object.assign({},o==null?void 0:o.idResult,{idType:"PASSPORT"}),h.jumioSdkFaceResult=o==null?void 0:o.faceResult):x===1?(console.log("第1步"),b.billingAddress.country||(h.billingAddress=_e(ae({},b.billingAddress),{country:"SG"})),h.sameResidentialFlag="N"):x===2?b.yearsWorking?(console.log("-------------2-1",JSON.stringify(b)),h.incomeYear=Ct(b.incomeYear),h.selfEmployment=b.selfEmployment?"Y":"N",h.serviceYears=b.yearsWorking[0],h.serviceMonths=b.yearsWorking[1],h.empPassExpiryDate=xe(b.passportExpiryDate).format("YYYY-MM-DD"),h.stepNo=3):(console.log("-------------2-2",JSON.stringify(b)),console.log(">>>>",JSON.stringify(h)),Object.keys(b).forEach(Z=>{Array.isArray(b[Z])&&(h[Z]=b[Z].map(Ve=>Ve.extra))}),h.stepNo=4):x===3?(h.stepNo=5,j?(h.determineLimitFlag="Y",h.preCreditLimit=100*1e3):h.preCreditLimit=b.preCreditLimit*1e3*100):x===4?(console.log("第四步"),h.pdpaFlag=b.pdpaFlag?"Y":"N",h.usaTaxResident=b.usaTaxResident?"Y":"N",h.dncFlag=b.dncFlag?"Y":"N",h.stepNo=6):x===5?console.log("第5步"):x===6&&console.log("第6步"),console.log("改变的数据后",h),h};return y.useEffect(()=>{console.log("urlParams===>",JSON.stringify(d)),a(be(!1)),te(),d.id&&$(parseInt(d.id))},[d]),r("div",{children:[I<4&&r(ne,{current:I,className:"bg-white ",children:[e(ne.Step,{title:t("apply_upgrade_personal_info")}),e(ne.Step,{title:t("apply_upgrade_address_info")}),e(ne.Step,{title:t("apply_upgrade_other_info")}),e(ne.Step,{title:t("apply_form_card_personalization")})]}),I===12?e(At,{}):e(g,{className:"m-3 border-0 mb-10",form:_,onFinish:Q,requiredMarkStyle:"text-optional",footer:I===12?null:e(q,{block:!0,type:"submit",color:"primary",size:"large",shape:"rounded",loading:H,children:e(s,{id:I===6?"common_submit":"common_next"})}),children:P?e(lt.Paragraph,{lineCount:20,animated:!0}):r(M,{children:[I===0&&e(dt,{}),I===1&&e(yt,{}),d.id==="2-1"&&e(ut,{}),d.id==="2-2"&&e(ft,{}),I===3&&e(_t,{}),I===4&&e(pt,{})]})}),e(st,{show:u,onConfirm:ee,phone:v,onClose:()=>k(!1)}),e(nt,{open:!0,setOpen:()=>null,applyCards:T,onOk:()=>Q(_.getFieldsValue(!0),!0)})]})}),Ct=l=>{if(l)return`${parseInt(`${(Number(l)||0)*100}`)}`};export{Bt as default};
