var q=Object.defineProperty;var O=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var C=(n,r,s)=>r in n?q(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s,K=(n,r)=>{for(var s in r||(r={}))G.call(r,s)&&C(n,s,r[s]);if(O)for(var s of O(r))H.call(r,s)&&C(n,s,r[s]);return n};var h=(n,r,s)=>new Promise((N,y)=>{var p=e=>{try{o(s.next(e))}catch(t){y(t)}},u=e=>{try{o(s.throw(e))}catch(t){y(t)}},o=e=>e.done?N(e.value):Promise.resolve(e.value).then(p,u);o((s=s.apply(n,r)).next())});import{r as L,u as g,a as Q,b as X,$ as Z,j as _,e as i,K as E,f as m,k as D,B as M,t as F,aY as B,U as k,a4 as f,g as d,T as ee,ag as te}from"./index-6701bc4a.js";import{C as se}from"./card-0f9563e7.js";import{D as oe}from"./divider-0fbf94b9.js";function ne(){const[n,r]=L.useState(!1),{applicationType:s,channelApplyNo:N}=g(l=>l.cardApply);L.useState("");const y=Q(),p=X();Z();const{userInfo:u,identityCheckFlag:o,sdkData:e}=g(l=>l.user),{jumioBaseConfig:t}=g(l=>l.cardApply);console.log("jumio======"+JSON.stringify(t));const x=()=>h(this,null,function*(){if(n)return;r(!0);const l=yield F("/dcs-apply-online/jumio/getWorkflowToken",{userReference:u==null?void 0:u.userId,workflowKeyType:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.workflowKeyType:t==null?void 0:t.jumioSet.workflowKeyType,credentialsTypeValues:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.credentialsTypeValues:t==null?void 0:t.jumioSet.credentialsTypeValues,applyType:{2:2,4:1,3:1,5:3}[s],credentialsCountryValues:[2].includes(s)?t==null?void 0:t.myInfoJumioSet.credentialsCountryValues:t==null?void 0:t.jumioSet.credentialsCountryValues,customerInternalReference:u==null?void 0:u.userId,applyNo:[2].includes(s)?N:""});y(B(l.applyNo)),y(k(l));const a=l.token,c=[2].includes(s)?t==null?void 0:t.myInfoJumioSet.datacenter:t==null?void 0:t.jumioSet.datacenter;Jumio.initialize(a,c),Jumio.start(W,Y)}),P=l=>{console.log("obj",typeof l);let a;return typeof l.credentials=="string"?a=JSON.parse(l.credentials):a=l.credentials,K({idResult:a.filter(c=>c.credentialCategory.toUpperCase()=="ID")[0],faceResult:a.filter(c=>c.credentialCategory.toUpperCase()=="FACE")[0]},l)},W=l=>h(this,null,function*(){var I,v,R,j,V,z;console.log("这里是Jumio给我的回调啊",l),console.log("上面的不好复制，可以复制这里的数据哦",JSON.stringify(l));const a=yield P(l);if(console.log("成功回调",JSON.stringify(a)),!a.idResult.idNumber||!a.idResult.lastName||!a.idResult.firstName){f.show(d("jumio_miss_prams")),r(!1),x();return}let c=a.idResult;console.log("identityCheckFlag",o);let A="P",S=c.idNumber.toUpperCase(),J=c.dateOfBirth.toUpperCase(),w=c.gender.toUpperCase(),U=c.firstName.toUpperCase(),b=c.lastName.toUpperCase();if((o!=null&&o.includes("idType")||o!=null&&o.includes("idNo"))&&(A!=((I=e==null?void 0:e.idType)==null?void 0:I.toUpperCase())||S!=((v=e==null?void 0:e.idNo)==null?void 0:v.toUpperCase()))){f.show(d("user_identities_do_not_match")),console.log("----------------------->",A,e==null?void 0:e.idType),console.log("----------------------->",S,e==null?void 0:e.idNo),p(-1);return}if(o!=null&&o.includes("birthDate")&&J.replace(/-/g,"")!=((R=e==null?void 0:e.birthDate)==null?void 0:R.toUpperCase())){f.show(d("user_identities_do_not_match")),console.log("----------------------->",J,e==null?void 0:e.birthDate),p(-1);return}if(o!=null&&o.includes("gender")&&w!=((j=e==null?void 0:e.gender)==null?void 0:j.toUpperCase())){f.show(d("user_identities_do_not_match")),console.log("----------------------->",w,e==null?void 0:e.gender),p(-1);return}if((o!=null&&o.includes("firstName")||o!=null&&o.includes("lastName"))&&(!U.includes((V=e==null?void 0:e.firstName)==null?void 0:V.toUpperCase())||!b.includes((z=e==null?void 0:e.lastName)==null?void 0:z.toUpperCase()))){f.show(d("user_identities_do_not_match")),console.log("----------------------->",U,e==null?void 0:e.firstName),console.log("----------------------->",b,e==null?void 0:e.lastName),p(-1);return}y(ee(a)),r(!1),T()}),Y=l=>{console.log("失败回调",JSON.stringify(l)),r(!1)},$=()=>{te.confirm({title:d("jumioAlert_Title"),content:d("jumioAlert_cnt"),onConfirm:()=>{T()}})},T=()=>{s==2?p("/myinfo/4",{replace:!0}):s==4?p("/jumio/0",{replace:!0}):p(-1)};return _("div",{children:[s===2&&_("div",{className:"p-4 text-minor text-xs",children:[i(E,{id:"jumio_myInfo_headDesc1"}),i(E,{id:"jumio_myInfo_headDesc2"})]}),_(se,{title:i(m,{id:"apply_jumio_passportTitle"}),style:{marginBottom:10},className:"p-0 rounded-lg text-xs px-5",headerClassName:"px-5",children:[s==2?i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"jumi_myInfo_cntDesc"})}):_(D,{children:[i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc1"})}),i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc2"})}),i("div",{className:"fz-xs mt-1 lh-20 pt-3",style:{color:"#909DAA"},children:i(m,{id:"apply_jumio_passportDesc3"})})]}),i(oe,{style:{height:1,backgroundColor:"#575799",marginTop:3,opacity:.2}}),i(M,{block:!0,type:"submit",color:"primary",size:"large",shape:"rounded",loading:n,onClick:x,children:i(m,{id:"apply_jumio_vertify"})}),s==2&&i(M,{block:!0,color:"primary",fill:"none",className:"text-center my-4 text-xs",onClick:$,children:i(m,{id:"jumio_btn_skip"})})]})]})}export{ne as default};
