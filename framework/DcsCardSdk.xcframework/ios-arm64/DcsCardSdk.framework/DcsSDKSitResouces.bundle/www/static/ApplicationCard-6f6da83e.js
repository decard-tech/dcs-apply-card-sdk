var Q=Object.defineProperty,W=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var I=(a,n,s)=>n in a?Q(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,b=(a,n)=>{for(var s in n||(n={}))$.call(n,s)&&I(a,s,n[s]);if(E)for(var s of E(n))z.call(n,s)&&I(a,s,n[s]);return a},w=(a,n)=>W(a,Z(n));var D=(a,n,s)=>new Promise((f,m)=>{var o=d=>{try{i(s.next(d))}catch(h){m(h)}},C=d=>{try{i(s.throw(d))}catch(h){m(h)}},i=d=>d.done?f(d.value):Promise.resolve(d.value).then(o,C);i((s=s.apply(a,n)).next())});import{r as c,j as g,e as l,b as G,u,a as H,t as v,P as B,Q as R,R as _,T as J,U as O,h as j,K as F,B as L,Z as M,_ as X,f as Y,S as ee}from"./index-45243e94.js";import{R as ae}from"./RecommendCard-fb5ab4f3.js";import"./index-2c9accc9.js";import"./native-input-10f267fd.js";const U=c.memo(a=>g("div",{className:"flex items-center my-5",children:[l("div",{className:"flex-auto h-0.5",style:{background:a.color||"linear-gradient(90deg, #FFF4EB 0%, #EED2BB 101.95%)"}}),l("div",{className:"w-2 h-2",style:{background:a.color||"#edd4bf",borderRadius:"50%"}}),l("div",{className:"px-6 text-base",style:{color:a.color||"#F0A76A"},children:a.children}),l("div",{className:"w-2 h-2",style:{background:a.color||"#edd4bf",borderRadius:"50%"}}),l("div",{className:"flex-auto h-0.5",style:{background:a.color||"linear-gradient(-90deg, #FFF4EB 0%, #EED2BB 101.95%)"}})]})),re=c.memo(()=>{const a=G(),n=u(e=>e.cardApply.scanCodeData),{applicationType:s,appliedCardsFlat:f}=u(e=>e.cardApply),m=u(e=>e.app.locale),[o,C]=c.useState(),[i,d]=c.useState(!0),[h,N]=c.useState(!1),[p,V]=c.useState(),{userInfo:y,recommendCardListFlag:x}=u(e=>e.user),r=H(),q=c.useCallback(e=>D(void 0,null,function*(){try{let t=[];(n==null?void 0:n.scanType)===2?t=(yield v("/dcs-apply-online/card/apply/login/queryAgentCardsList",w(b({applicationType:s},e),{agentCode:(n==null?void 0:n.agentCode)||void 0}))).filter(K=>K.cardState==="S")||[]:t=(yield v("/dcs-apply-online/card/apply/login/queryCardsList/sdk",b({applicationType:s,orgCode:(y==null?void 0:y.orgCode)||void 0},e)))||[],C(t)}catch(t){console.log("err",t)}finally{d(!1)}}),[]);c.useEffect(()=>{q()},[m]),c.useEffect(()=>{A();const e=()=>{document.visibilityState==="visible"&&(console.log("现在成功从myinfo回来了啊"),A())};return document.addEventListener("visibilitychange",e),()=>{console.log("ApplicationCard.useEffect卸载了"),document.removeEventListener("visibilitychange",e),r(B()),r(R("")),r(_("")),r(J()),r(O())}},[]);const A=()=>{typeof DcsCardBase!="undefined"&&DcsCardBase.getMyinfoCallBack("",e=>{r(B()),r(R("")),r(_("")),r(J()),r(O()),console.log("卡申请页面,SUCESS======================================================",e);let t=JSON.parse(decodeURIComponent(JSON.parse(e).data));console.log("innerJsonObj",t),t.host=="callback"&&a(`/myinfo/1?${t.query}`)},e=>{console.log("ERROR======================================================"),console.log("myinfo回调失败",e)})},S=e=>{console.log(1111,x),!i&&(e.vipFlag===1?location.href="https://dcscc.com/imperium":e.recommend===1&&x==1?(V(e),N(!0)):(r(M([e])),P()))},P=()=>{s===2?(d(!0),v("/dcs-apply-online/myinfo/getAuthoriseUrl/v3",{version:"v2"}).then(e=>{location.href=e.requestUrl}).finally(()=>{d(!1)})):s===3?a("/manual/0"):s===4&&a("/ApplyIDVerification")},k=e=>{if(i)return;console.log("77777777777",e),r(M([e])),r(X([{channelCreditCardId:e.channelCreditCardId,productId:e.productList[0].productId}])),console.log("appliedCardsFlat",f);let t=e.appLink.substring(e.appLink.indexOf(".com")+4);e.vipFlag===1?location.href="https://dcscc.com/imperium":a(t,{state:{card:e}})};return g("div",{className:"px-3",children:[g("div",{className:"pb-10 pt-4",children:[(o==null?void 0:o.find(e=>e.suggestFlag===1))&&l(U,{children:l(Y,{id:"cardApplySortDesc1"})}),o==null?void 0:o.filter(e=>e.suggestFlag===1).map(e=>g("div",{className:"mb-3 px-3 pt-4 pb-3 pl-5 flex items-start rounded-lg shadow-lg",style:{background:"linear-gradient(99.39deg, #FFFAEE 24.87%, #FFECDE 87.7%)"},onClick:()=>k(e),children:[l("div",{children:l(j,{width:90,src:e.channelCardShowImage,alt:e.channelCardName})}),g("div",{className:"pl-4 flex-1",children:[l("h4",{className:"font-semibold text-base leading-none",children:e.channelCardName}),l("p",{className:"text-minor my-2 leading-none",children:e.channelCardDescribe}),l(L,{loading:i&&e.channelCreditCardId==(p==null?void 0:p.channelCreditCardId),onClick:t=>{t.stopPropagation(),S(e)},color:"primary",shape:"rounded",children:l(F,{className:"px-2 text-sm",id:"apply__apply_now"})})]})]},e.channelCreditCardId)),(o==null?void 0:o.find(e=>!e.suggestFlag))&&(o==null?void 0:o.find(e=>e.suggestFlag===1))&&l(U,{color:"#D6E4FF",children:l(F,{className:"text-minor",id:"cardApplySortDesc2"})}),o==null?void 0:o.filter(e=>!e.suggestFlag).map(e=>g("div",{className:"mb-3 px-3 pt-4 pb-3 pl-5 flex items-start bg-white rounded-lg shadow-lg",onClick:()=>k(e),children:[l("div",{children:l(j,{width:90,src:e.channelCardShowImage,alt:e.channelCardName})}),g("div",{className:"pl-4 flex-1",children:[l("h4",{className:"font-semibold text-base leading-none",children:e.channelCardName}),l("p",{className:"text-minor my-2 leading-none",children:e.channelCardDescribe}),l(L,{loading:i&&e.channelCreditCardId==(p==null?void 0:p.channelCreditCardId),onClick:t=>{t.stopPropagation(),S(e)},color:"primary",shape:"rounded",children:l(F,{className:"px-2 text-sm",id:"apply__apply_now"})})]})]},e.channelCreditCardId))]}),i&&!o&&l(ee,{}),l(ae,{selCard:p,showVisitor:h,onClose:()=>(N(!1),Promise.resolve())})]})});export{re as default};
